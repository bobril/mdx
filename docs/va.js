(function(e){"use strict";var t=__bbb.Mb;var n=__bbb.ac;var i=__bbb.nc;var a=__bbb.Nb;var o=__bbb.eb;var r=__bbb.Ac;var s=__bbb.fd;var l=__bbb.Gc;var d=__bbb.Hc;var c=__bbb.Ic;var h=__bbb.dc;var _=__bbb.gc;var g=__bbb.te;var p=__bbb.ue;var b=__bbb.ve;var u=__bbb.we;var y=__bbb.Tb;var x=__bbb.zc;var k=__bbb.fe;var m=__bbb.xe;var f=__bbb.Qd;var v=__bbb.Zd;var w=__bbb.ye;var S=__bbb.ob;var B=__bbb.sc;var L,$,A;var R=function(){var e=t(function(e,t,n,i){for(n=n||{},i=e.length;i--;n[e[i]]=t);return n},"o"),n=[1,15],i=[1,7],a=[1,13],o=[1,14],r=[1,19],s=[1,16],l=[1,17],d=[1,18],c=[8,30],h=[8,10,21,28,29,30,31,39,43,46],_=[1,23],g=[1,24],p=[8,10,15,16,21,28,29,30,31,39,43,46],b=[8,10,15,16,21,27,28,29,30,31,39,43,46],u=[1,49];var y={trace:t(function e(){},"trace"),yy:{},symbols_:{error:2,spaceLines:3,SPACELINE:4,NL:5,separator:6,SPACE:7,EOF:8,start:9,BLOCK_DIAGRAM_KEY:10,document:11,stop:12,statement:13,link:14,LINK:15,START_LINK:16,LINK_LABEL:17,STR:18,nodeStatement:19,columnsStatement:20,SPACE_BLOCK:21,blockStatement:22,classDefStatement:23,cssClassStatement:24,styleStatement:25,node:26,SIZE:27,COLUMNS:28,"id-block":29,end:30,NODE_ID:31,nodeShapeNLabel:32,dirList:33,DIR:34,NODE_DSTART:35,NODE_DEND:36,BLOCK_ARROW_START:37,BLOCK_ARROW_END:38,classDef:39,CLASSDEF_ID:40,CLASSDEF_STYLEOPTS:41,DEFAULT:42,class:43,CLASSENTITY_IDS:44,STYLECLASS:45,style:46,STYLE_ENTITY_IDS:47,STYLE_DEFINITION_DATA:48,$accept:0,$end:1},terminals_:{2:"error",4:"SPACELINE",5:"NL",7:"SPACE",8:"EOF",10:"BLOCK_DIAGRAM_KEY",15:"LINK",16:"START_LINK",17:"LINK_LABEL",18:"STR",21:"SPACE_BLOCK",27:"SIZE",28:"COLUMNS",29:"id-block",30:"end",31:"NODE_ID",34:"DIR",35:"NODE_DSTART",36:"NODE_DEND",37:"BLOCK_ARROW_START",38:"BLOCK_ARROW_END",39:"classDef",40:"CLASSDEF_ID",41:"CLASSDEF_STYLEOPTS",42:"DEFAULT",43:"class",44:"CLASSENTITY_IDS",45:"STYLECLASS",46:"style",47:"STYLE_ENTITY_IDS",48:"STYLE_DEFINITION_DATA"},productions_:[0,[3,1],[3,2],[3,2],[6,1],[6,1],[6,1],[9,3],[12,1],[12,1],[12,2],[12,2],[11,1],[11,2],[14,1],[14,4],[13,1],[13,1],[13,1],[13,1],[13,1],[13,1],[13,1],[19,3],[19,2],[19,1],[20,1],[22,4],[22,3],[26,1],[26,2],[33,1],[33,2],[32,3],[32,4],[23,3],[23,3],[24,3],[25,3]],performAction:t(function e(t,n,i,a,o,r,s){var l=r.length-1;switch(o){case 4:a.getLogger().debug("Rule: separator (NL) ");break;case 5:a.getLogger().debug("Rule: separator (Space) ");break;case 6:a.getLogger().debug("Rule: separator (EOF) ");break;case 7:a.getLogger().debug("Rule: hierarchy: ",r[l-1]);a.setHierarchy(r[l-1]);break;case 8:a.getLogger().debug("Stop NL ");break;case 9:a.getLogger().debug("Stop EOF ");break;case 10:a.getLogger().debug("Stop NL2 ");break;case 11:a.getLogger().debug("Stop EOF2 ");break;case 12:a.getLogger().debug("Rule: statement: ",r[l]);typeof r[l].length==="number"?this.$=r[l]:this.$=[r[l]];break;case 13:a.getLogger().debug("Rule: statement #2: ",r[l-1]);this.$=[r[l-1]].concat(r[l]);break;case 14:a.getLogger().debug("Rule: link: ",r[l],t);this.$={edgeTypeStr:r[l],label:""};break;case 15:a.getLogger().debug("Rule: LABEL link: ",r[l-3],r[l-1],r[l]);this.$={edgeTypeStr:r[l],label:r[l-1]};break;case 18:let e=parseInt(r[l]),n=a.generateId();this.$={id:n,type:"space",label:"",width:e,children:[]};break;case 23:a.getLogger().debug("Rule: (nodeStatement link node) ",r[l-2],r[l-1],r[l]," typestr: ",r[l-1].edgeTypeStr);let i=a.edgeStrToEdgeData(r[l-1].edgeTypeStr);this.$=[{id:r[l-2].id,label:r[l-2].label,type:r[l-2].type,directions:r[l-2].directions},{id:r[l-2].id+"-"+r[l].id,start:r[l-2].id,end:r[l].id,label:r[l-1].label,type:"edge",directions:r[l].directions,arrowTypeEnd:i,arrowTypeStart:"arrow_open"},{id:r[l].id,label:r[l].label,type:a.typeStr2Type(r[l].typeStr),directions:r[l].directions}];break;case 24:a.getLogger().debug("Rule: nodeStatement (abc88 node size) ",r[l-1],r[l]);this.$={id:r[l-1].id,label:r[l-1].label,type:a.typeStr2Type(r[l-1].typeStr),directions:r[l-1].directions,widthInColumns:parseInt(r[l],10)};break;case 25:a.getLogger().debug("Rule: nodeStatement (node) ",r[l]);this.$={id:r[l].id,label:r[l].label,type:a.typeStr2Type(r[l].typeStr),directions:r[l].directions,widthInColumns:1};break;case 26:a.getLogger().debug("APA123",this?this:"na");a.getLogger().debug("COLUMNS: ",r[l]);this.$={type:"column-setting",columns:r[l]==="auto"?-1:parseInt(r[l])};break;case 27:a.getLogger().debug("Rule: id-block statement : ",r[l-2],r[l-1]);let s=a.generateId();this.$={...r[l-2],type:"composite",children:r[l-1]};break;case 28:a.getLogger().debug("Rule: blockStatement : ",r[l-2],r[l-1],r[l]);let d=a.generateId();this.$={id:d,type:"composite",label:"",children:r[l-1]};break;case 29:a.getLogger().debug("Rule: node (NODE_ID separator): ",r[l]);this.$={id:r[l]};break;case 30:a.getLogger().debug("Rule: node (NODE_ID nodeShapeNLabel separator): ",r[l-1],r[l]);this.$={id:r[l-1],label:r[l].label,typeStr:r[l].typeStr,directions:r[l].directions};break;case 31:a.getLogger().debug("Rule: dirList: ",r[l]);this.$=[r[l]];break;case 32:a.getLogger().debug("Rule: dirList: ",r[l-1],r[l]);this.$=[r[l-1]].concat(r[l]);break;case 33:a.getLogger().debug("Rule: nodeShapeNLabel: ",r[l-2],r[l-1],r[l]);this.$={typeStr:r[l-2]+r[l],label:r[l-1]};break;case 34:a.getLogger().debug("Rule: BLOCK_ARROW nodeShapeNLabel: ",r[l-3],r[l-2]," #3:",r[l-1],r[l]);this.$={typeStr:r[l-3]+r[l],label:r[l-2],directions:r[l-1]};break;case 35:case 36:this.$={type:"classDef",id:r[l-1].trim(),css:r[l].trim()};break;case 37:this.$={type:"applyClass",id:r[l-1].trim(),styleClass:r[l].trim()};break;case 38:this.$={type:"applyStyles",id:r[l-1].trim(),stylesStr:r[l].trim()};break}},"anonymous"),table:[{9:1,10:[1,2]},{1:[3]},{10:n,11:3,13:4,19:5,20:6,21:i,22:8,23:9,24:10,25:11,26:12,28:a,29:o,31:r,39:s,43:l,46:d},{8:[1,20]},e(c,[2,12],{13:4,19:5,20:6,22:8,23:9,24:10,25:11,26:12,11:21,10:n,21:i,28:a,29:o,31:r,39:s,43:l,46:d}),e(h,[2,16],{14:22,15:_,16:g}),e(h,[2,17]),e(h,[2,18]),e(h,[2,19]),e(h,[2,20]),e(h,[2,21]),e(h,[2,22]),e(p,[2,25],{27:[1,25]}),e(h,[2,26]),{19:26,26:12,31:r},{10:n,11:27,13:4,19:5,20:6,21:i,22:8,23:9,24:10,25:11,26:12,28:a,29:o,31:r,39:s,43:l,46:d},{40:[1,28],42:[1,29]},{44:[1,30]},{47:[1,31]},e(b,[2,29],{32:32,35:[1,33],37:[1,34]}),{1:[2,7]},e(c,[2,13]),{26:35,31:r},{31:[2,14]},{17:[1,36]},e(p,[2,24]),{10:n,11:37,13:4,14:22,15:_,16:g,19:5,20:6,21:i,22:8,23:9,24:10,25:11,26:12,28:a,29:o,31:r,39:s,43:l,46:d},{30:[1,38]},{41:[1,39]},{41:[1,40]},{45:[1,41]},{48:[1,42]},e(b,[2,30]),{18:[1,43]},{18:[1,44]},e(p,[2,23]),{18:[1,45]},{30:[1,46]},e(h,[2,28]),e(h,[2,35]),e(h,[2,36]),e(h,[2,37]),e(h,[2,38]),{36:[1,47]},{33:48,34:u},{15:[1,50]},e(h,[2,27]),e(b,[2,33]),{38:[1,51]},{33:52,34:u,38:[2,31]},{31:[2,15]},e(b,[2,34]),{38:[2,32]}],defaultActions:{20:[2,7],23:[2,14],50:[2,15],52:[2,32]},parseError:t(function e(t,n){if(n.recoverable){this.trace(t)}else{var i=new Error(t);i.hash=n;throw i}},"parseError"),parse:t(function e(n){var i=this,a=[0],o=[],r=[null],s=[],l=this.table,d="",c=0,h=0,_=0,g=2,p=1;var b=s.slice.call(arguments,1);var u=Object.create(this.lexer);var y={yy:{}};for(var x in this.yy){Object.prototype.hasOwnProperty.call(this.yy,x)&&(y.yy[x]=this.yy[x])}u.setInput(n,y.yy);y.yy.lexer=u;y.yy.parser=this;typeof u.yylloc=="undefined"&&(u.yylloc={});var k=u.yylloc;s.push(k);var m=u.options&&u.options.ranges;if(typeof y.yy.parseError==="function"){this.parseError=y.yy.parseError}else{this.parseError=Object.getPrototypeOf(this).parseError}function f(e){a.length=a.length-2*e;r.length=r.length-e;s.length=s.length-e}t(f,"popStack");function v(){var e;e=o.pop()||u.lex()||p;if(typeof e!=="number"){if(e instanceof Array){o=e;e=o.pop()}e=i.symbols_[e]||e}return e}t(v,"lex");var w,S,B,L,$,A={},R,E,H,D;while(!0){B=a[a.length-1];if(this.defaultActions[B]){L=this.defaultActions[B]}else{(w===null||typeof w=="undefined")&&(w=v());L=l[B]&&l[B][w]}if(typeof L==="undefined"||!L.length||!L[0]){var F="";D=[];for(R in l[B]){this.terminals_[R]&&R>g&&D.push("'"+this.terminals_[R]+"'")}if(u.showPosition){F="Parse error on line "+(c+1)+":\n"+u.showPosition()+"\nExpecting "+D.join(", ")+", got '"+(this.terminals_[w]||w)+"'"}else{F="Parse error on line "+(c+1)+": Unexpected "+(w==p?"end of input":"'"+(this.terminals_[w]||w)+"'")}this.parseError(F,{text:u.match,token:this.terminals_[w]||w,line:u.yylineno,loc:k,expected:D})}if(L[0]instanceof Array&&L.length>1){throw new Error("Parse Error: multiple actions possible at state: "+B+", token: "+w)}switch(L[0]){case 1:a.push(w);r.push(u.yytext);s.push(u.yylloc);a.push(L[1]);w=null;if(!S){h=u.yyleng;d=u.yytext;c=u.yylineno;k=u.yylloc;_>0&&_--}else{w=S;S=null}break;case 2:E=this.productions_[L[1]][1];A.$=r[r.length-E];A._$={first_line:s[s.length-(E||1)].first_line,last_line:s[s.length-1].last_line,first_column:s[s.length-(E||1)].first_column,last_column:s[s.length-1].last_column};m&&(A._$.range=[s[s.length-(E||1)].range[0],s[s.length-1].range[1]]);$=this.performAction.apply(A,[d,h,c,y.yy,L[1],r,s].concat(b));if(typeof $!=="undefined"){return $}if(E){a=a.slice(0,-1*E*2);r=r.slice(0,-1*E);s=s.slice(0,-1*E)}a.push(this.productions_[L[1]][0]);r.push(A.$);s.push(A._$);H=l[a[a.length-2]][a[a.length-1]];a.push(H);break;case 3:return!0}}return!0},"parse")};var x=function(){var e={EOF:1,parseError:t(function e(t,n){if(this.yy.parser){this.yy.parser.parseError(t,n)}else{throw new Error(t)}},"parseError"),setInput:t(function(e,t){this.yy=t||this.yy||{};this._input=e;this._more=this._backtrack=this.done=!1;this.yylineno=this.yyleng=0;this.yytext=this.matched=this.match="";this.conditionStack=["INITIAL"];this.yylloc={first_line:1,first_column:0,last_line:1,last_column:0};this.options.ranges&&(this.yylloc.range=[0,0]);this.offset=0;return this},"setInput"),input:t(function(){var e=this._input[0];this.yytext+=e;this.yyleng++;this.offset++;this.match+=e;this.matched+=e;var t=e.match(/(?:\r\n?|\n).*/g);if(t){this.yylineno++;this.yylloc.last_line++}else{this.yylloc.last_column++}this.options.ranges&&this.yylloc.range[1]++;this._input=this._input.slice(1);return e},"input"),unput:t(function(e){var t=e.length;var n=e.split(/(?:\r\n?|\n)/g);this._input=e+this._input;this.yytext=this.yytext.substr(0,this.yytext.length-t);this.offset-=t;var i=this.match.split(/(?:\r\n?|\n)/g);this.match=this.match.substr(0,this.match.length-1);this.matched=this.matched.substr(0,this.matched.length-1);n.length-1&&(this.yylineno-=n.length-1);var a=this.yylloc.range;this.yylloc={first_line:this.yylloc.first_line,last_line:this.yylineno+1,first_column:this.yylloc.first_column,last_column:n?(n.length===i.length?this.yylloc.first_column:0)+i[i.length-n.length].length-n[0].length:this.yylloc.first_column-t};this.options.ranges&&(this.yylloc.range=[a[0],a[0]+this.yyleng-t]);this.yyleng=this.yytext.length;return this},"unput"),more:t(function(){this._more=!0;return this},"more"),reject:t(function(){if(this.options.backtrack_lexer){this._backtrack=!0}else{return this.parseError("Lexical error on line "+(this.yylineno+1)+". You can only invoke reject() in the lexer when the lexer is of the backtracking persuasion (options.backtrack_lexer = true).\n"+this.showPosition(),{text:"",token:null,line:this.yylineno})}return this},"reject"),less:t(function(e){this.unput(this.match.slice(e))},"less"),pastInput:t(function(){var e=this.matched.substr(0,this.matched.length-this.match.length);return(e.length>20?"...":"")+e.substr(-20).replace(/\n/g,"")},"pastInput"),upcomingInput:t(function(){var e=this.match;e.length<20&&(e+=this._input.substr(0,20-e.length));return(e.substr(0,20)+(e.length>20?"...":"")).replace(/\n/g,"")},"upcomingInput"),showPosition:t(function(){var e=this.pastInput();var t=new Array(e.length+1).join("-");return e+this.upcomingInput()+"\n"+t+"^"},"showPosition"),test_match:t(function(e,t){var n,i,a;if(this.options.backtrack_lexer){a={yylineno:this.yylineno,yylloc:{first_line:this.yylloc.first_line,last_line:this.last_line,first_column:this.yylloc.first_column,last_column:this.yylloc.last_column},yytext:this.yytext,match:this.match,matches:this.matches,matched:this.matched,yyleng:this.yyleng,offset:this.offset,_more:this._more,_input:this._input,yy:this.yy,conditionStack:this.conditionStack.slice(0),done:this.done};this.options.ranges&&(a.yylloc.range=this.yylloc.range.slice(0))}i=e[0].match(/(?:\r\n?|\n).*/g);i&&(this.yylineno+=i.length);this.yylloc={first_line:this.yylloc.last_line,last_line:this.yylineno+1,first_column:this.yylloc.last_column,last_column:i?i[i.length-1].length-i[i.length-1].match(/\r?\n?/)[0].length:this.yylloc.last_column+e[0].length};this.yytext+=e[0];this.match+=e[0];this.matches=e;this.yyleng=this.yytext.length;this.options.ranges&&(this.yylloc.range=[this.offset,this.offset+=this.yyleng]);this._more=!1;this._backtrack=!1;this._input=this._input.slice(e[0].length);this.matched+=e[0];n=this.performAction.call(this,this.yy,this,t,this.conditionStack[this.conditionStack.length-1]);this.done&&this._input&&(this.done=!1);if(n){return n}else if(this._backtrack){for(var o in a){this[o]=a[o]}return!1}return!1},"test_match"),next:t(function(){if(this.done){return this.EOF}this._input||(this.done=!0);var e,t,n,i;if(!this._more){this.yytext="";this.match=""}var a=this._currentRules();for(var o=0;o<a.length;o++){n=this._input.match(this.rules[a[o]]);if(n&&(!t||n[0].length>t[0].length)){t=n;i=o;if(this.options.backtrack_lexer){e=this.test_match(n,a[o]);if(e!==!1){return e}else if(this._backtrack){t=!1;continue}else{return!1}}else if(!this.options.flex){break}}}if(t){e=this.test_match(t,a[i]);if(e!==!1){return e}return!1}if(this._input===""){return this.EOF}else{return this.parseError("Lexical error on line "+(this.yylineno+1)+". Unrecognized text.\n"+this.showPosition(),{text:"",token:null,line:this.yylineno})}},"next"),lex:t(function e(){var t=this.next();if(t){return t}else{return this.lex()}},"lex"),begin:t(function e(t){this.conditionStack.push(t)},"begin"),popState:t(function e(){var t=this.conditionStack.length-1;if(t>0){return this.conditionStack.pop()}else{return this.conditionStack[0]}},"popState"),_currentRules:t(function e(){if(this.conditionStack.length&&this.conditionStack[this.conditionStack.length-1]){return this.conditions[this.conditionStack[this.conditionStack.length-1]].rules}else{return this.conditions["INITIAL"].rules}},"_currentRules"),topState:t(function e(t){t=this.conditionStack.length-1-Math.abs(t||0);if(t>=0){return this.conditionStack[t]}else{return"INITIAL"}},"topState"),pushState:t(function e(t){this.begin(t)},"pushState"),stateStackSize:t(function e(){return this.conditionStack.length},"stateStackSize"),options:{},performAction:t(function e(t,n,i,a){switch(i){case 0:t.getLogger().debug("Found block-beta");return 10;break;case 1:t.getLogger().debug("Found id-block");return 29;break;case 2:t.getLogger().debug("Found block");return 10;break;case 3:t.getLogger().debug(".",n.yytext);break;case 4:t.getLogger().debug("_",n.yytext);break;case 5:return 5;break;case 6:n.yytext=-1;return 28;break;case 7:n.yytext=n.yytext.replace(/columns\s+/,"");t.getLogger().debug("COLUMNS (LEX)",n.yytext);return 28;break;case 8:this.pushState("md_string");break;case 9:return"MD_STR";break;case 10:this.popState();break;case 11:this.pushState("string");break;case 12:t.getLogger().debug("LEX: POPPING STR:",n.yytext);this.popState();break;case 13:t.getLogger().debug("LEX: STR end:",n.yytext);return"STR";break;case 14:n.yytext=n.yytext.replace(/space\:/,"");t.getLogger().debug("SPACE NUM (LEX)",n.yytext);return 21;break;case 15:n.yytext="1";t.getLogger().debug("COLUMNS (LEX)",n.yytext);return 21;break;case 16:return 42;break;case 17:return"LINKSTYLE";break;case 18:return"INTERPOLATE";break;case 19:this.pushState("CLASSDEF");return 39;break;case 20:this.popState();this.pushState("CLASSDEFID");return"DEFAULT_CLASSDEF_ID";break;case 21:this.popState();this.pushState("CLASSDEFID");return 40;break;case 22:this.popState();return 41;break;case 23:this.pushState("CLASS");return 43;break;case 24:this.popState();this.pushState("CLASS_STYLE");return 44;break;case 25:this.popState();return 45;break;case 26:this.pushState("STYLE_STMNT");return 46;break;case 27:this.popState();this.pushState("STYLE_DEFINITION");return 47;break;case 28:this.popState();return 48;break;case 29:this.pushState("acc_title");return"acc_title";break;case 30:this.popState();return"acc_title_value";break;case 31:this.pushState("acc_descr");return"acc_descr";break;case 32:this.popState();return"acc_descr_value";break;case 33:this.pushState("acc_descr_multiline");break;case 34:this.popState();break;case 35:return"acc_descr_multiline_value";break;case 36:return 30;break;case 37:this.popState();t.getLogger().debug("Lex: ((");return"NODE_DEND";break;case 38:this.popState();t.getLogger().debug("Lex: ((");return"NODE_DEND";break;case 39:this.popState();t.getLogger().debug("Lex: ))");return"NODE_DEND";break;case 40:this.popState();t.getLogger().debug("Lex: ((");return"NODE_DEND";break;case 41:this.popState();t.getLogger().debug("Lex: ((");return"NODE_DEND";break;case 42:this.popState();t.getLogger().debug("Lex: (-");return"NODE_DEND";break;case 43:this.popState();t.getLogger().debug("Lex: -)");return"NODE_DEND";break;case 44:this.popState();t.getLogger().debug("Lex: ((");return"NODE_DEND";break;case 45:this.popState();t.getLogger().debug("Lex: ]]");return"NODE_DEND";break;case 46:this.popState();t.getLogger().debug("Lex: (");return"NODE_DEND";break;case 47:this.popState();t.getLogger().debug("Lex: ])");return"NODE_DEND";break;case 48:this.popState();t.getLogger().debug("Lex: /]");return"NODE_DEND";break;case 49:this.popState();t.getLogger().debug("Lex: /]");return"NODE_DEND";break;case 50:this.popState();t.getLogger().debug("Lex: )]");return"NODE_DEND";break;case 51:this.popState();t.getLogger().debug("Lex: )");return"NODE_DEND";break;case 52:this.popState();t.getLogger().debug("Lex: ]>");return"NODE_DEND";break;case 53:this.popState();t.getLogger().debug("Lex: ]");return"NODE_DEND";break;case 54:t.getLogger().debug("Lexa: -)");this.pushState("NODE");return 35;break;case 55:t.getLogger().debug("Lexa: (-");this.pushState("NODE");return 35;break;case 56:t.getLogger().debug("Lexa: ))");this.pushState("NODE");return 35;break;case 57:t.getLogger().debug("Lexa: )");this.pushState("NODE");return 35;break;case 58:t.getLogger().debug("Lex: (((");this.pushState("NODE");return 35;break;case 59:t.getLogger().debug("Lexa: )");this.pushState("NODE");return 35;break;case 60:t.getLogger().debug("Lexa: )");this.pushState("NODE");return 35;break;case 61:t.getLogger().debug("Lexa: )");this.pushState("NODE");return 35;break;case 62:t.getLogger().debug("Lexc: >");this.pushState("NODE");return 35;break;case 63:t.getLogger().debug("Lexa: ([");this.pushState("NODE");return 35;break;case 64:t.getLogger().debug("Lexa: )");this.pushState("NODE");return 35;break;case 65:this.pushState("NODE");return 35;break;case 66:this.pushState("NODE");return 35;break;case 67:this.pushState("NODE");return 35;break;case 68:this.pushState("NODE");return 35;break;case 69:this.pushState("NODE");return 35;break;case 70:this.pushState("NODE");return 35;break;case 71:this.pushState("NODE");return 35;break;case 72:t.getLogger().debug("Lexa: [");this.pushState("NODE");return 35;break;case 73:this.pushState("BLOCK_ARROW");t.getLogger().debug("LEX ARR START");return 37;break;case 74:t.getLogger().debug("Lex: NODE_ID",n.yytext);return 31;break;case 75:t.getLogger().debug("Lex: EOF",n.yytext);return 8;break;case 76:this.pushState("md_string");break;case 77:this.pushState("md_string");break;case 78:return"NODE_DESCR";break;case 79:this.popState();break;case 80:t.getLogger().debug("Lex: Starting string");this.pushState("string");break;case 81:t.getLogger().debug("LEX ARR: Starting string");this.pushState("string");break;case 82:t.getLogger().debug("LEX: NODE_DESCR:",n.yytext);return"NODE_DESCR";break;case 83:t.getLogger().debug("LEX POPPING");this.popState();break;case 84:t.getLogger().debug("Lex: =>BAE");this.pushState("ARROW_DIR");break;case 85:n.yytext=n.yytext.replace(/^,\s*/,"");t.getLogger().debug("Lex (right): dir:",n.yytext);return"DIR";break;case 86:n.yytext=n.yytext.replace(/^,\s*/,"");t.getLogger().debug("Lex (left):",n.yytext);return"DIR";break;case 87:n.yytext=n.yytext.replace(/^,\s*/,"");t.getLogger().debug("Lex (x):",n.yytext);return"DIR";break;case 88:n.yytext=n.yytext.replace(/^,\s*/,"");t.getLogger().debug("Lex (y):",n.yytext);return"DIR";break;case 89:n.yytext=n.yytext.replace(/^,\s*/,"");t.getLogger().debug("Lex (up):",n.yytext);return"DIR";break;case 90:n.yytext=n.yytext.replace(/^,\s*/,"");t.getLogger().debug("Lex (down):",n.yytext);return"DIR";break;case 91:n.yytext="]>";t.getLogger().debug("Lex (ARROW_DIR end):",n.yytext);this.popState();this.popState();return"BLOCK_ARROW_END";break;case 92:t.getLogger().debug("Lex: LINK","#"+n.yytext+"#");return 15;break;case 93:t.getLogger().debug("Lex: LINK",n.yytext);return 15;break;case 94:t.getLogger().debug("Lex: LINK",n.yytext);return 15;break;case 95:t.getLogger().debug("Lex: LINK",n.yytext);return 15;break;case 96:t.getLogger().debug("Lex: START_LINK",n.yytext);this.pushState("LLABEL");return 16;break;case 97:t.getLogger().debug("Lex: START_LINK",n.yytext);this.pushState("LLABEL");return 16;break;case 98:t.getLogger().debug("Lex: START_LINK",n.yytext);this.pushState("LLABEL");return 16;break;case 99:this.pushState("md_string");break;case 100:t.getLogger().debug("Lex: Starting string");this.pushState("string");return"LINK_LABEL";break;case 101:this.popState();t.getLogger().debug("Lex: LINK","#"+n.yytext+"#");return 15;break;case 102:this.popState();t.getLogger().debug("Lex: LINK",n.yytext);return 15;break;case 103:this.popState();t.getLogger().debug("Lex: LINK",n.yytext);return 15;break;case 104:t.getLogger().debug("Lex: COLON",n.yytext);n.yytext=n.yytext.slice(1);return 27;break}},"anonymous"),rules:[/^(?:block-beta\b)/,/^(?:block:)/,/^(?:block\b)/,/^(?:[\s]+)/,/^(?:[\n]+)/,/^(?:((\u000D\u000A)|(\u000A)))/,/^(?:columns\s+auto\b)/,/^(?:columns\s+[\d]+)/,/^(?:["][`])/,/^(?:[^`"]+)/,/^(?:[`]["])/,/^(?:["])/,/^(?:["])/,/^(?:[^"]*)/,/^(?:space[:]\d+)/,/^(?:space\b)/,/^(?:default\b)/,/^(?:linkStyle\b)/,/^(?:interpolate\b)/,/^(?:classDef\s+)/,/^(?:DEFAULT\s+)/,/^(?:\w+\s+)/,/^(?:[^\n]*)/,/^(?:class\s+)/,/^(?:(\w+)+((,\s*\w+)*))/,/^(?:[^\n]*)/,/^(?:style\s+)/,/^(?:(\w+)+((,\s*\w+)*))/,/^(?:[^\n]*)/,/^(?:accTitle\s*:\s*)/,/^(?:(?!\n||)*[^\n]*)/,/^(?:accDescr\s*:\s*)/,/^(?:(?!\n||)*[^\n]*)/,/^(?:accDescr\s*\{\s*)/,/^(?:[\}])/,/^(?:[^\}]*)/,/^(?:end\b\s*)/,/^(?:\(\(\()/,/^(?:\)\)\))/,/^(?:[\)]\))/,/^(?:\}\})/,/^(?:\})/,/^(?:\(-)/,/^(?:-\))/,/^(?:\(\()/,/^(?:\]\])/,/^(?:\()/,/^(?:\]\))/,/^(?:\\\])/,/^(?:\/\])/,/^(?:\)\])/,/^(?:[\)])/,/^(?:\]>)/,/^(?:[\]])/,/^(?:-\))/,/^(?:\(-)/,/^(?:\)\))/,/^(?:\))/,/^(?:\(\(\()/,/^(?:\(\()/,/^(?:\{\{)/,/^(?:\{)/,/^(?:>)/,/^(?:\(\[)/,/^(?:\()/,/^(?:\[\[)/,/^(?:\[\|)/,/^(?:\[\()/,/^(?:\)\)\))/,/^(?:\[\\)/,/^(?:\[\/)/,/^(?:\[\\)/,/^(?:\[)/,/^(?:<\[)/,/^(?:[^\(\[\n\-\)\{\}\s\<\>:]+)/,/^(?:$)/,/^(?:["][`])/,/^(?:["][`])/,/^(?:[^`"]+)/,/^(?:[`]["])/,/^(?:["])/,/^(?:["])/,/^(?:[^"]+)/,/^(?:["])/,/^(?:\]>\s*\()/,/^(?:,?\s*right\s*)/,/^(?:,?\s*left\s*)/,/^(?:,?\s*x\s*)/,/^(?:,?\s*y\s*)/,/^(?:,?\s*up\s*)/,/^(?:,?\s*down\s*)/,/^(?:\)\s*)/,/^(?:\s*[xo<]?--+[-xo>]\s*)/,/^(?:\s*[xo<]?==+[=xo>]\s*)/,/^(?:\s*[xo<]?-?\.+-[xo>]?\s*)/,/^(?:\s*~~[\~]+\s*)/,/^(?:\s*[xo<]?--\s*)/,/^(?:\s*[xo<]?==\s*)/,/^(?:\s*[xo<]?-\.\s*)/,/^(?:["][`])/,/^(?:["])/,/^(?:\s*[xo<]?--+[-xo>]\s*)/,/^(?:\s*[xo<]?==+[=xo>]\s*)/,/^(?:\s*[xo<]?-?\.+-[xo>]?\s*)/,/^(?::\d+)/],conditions:{STYLE_DEFINITION:{rules:[28],inclusive:!1},STYLE_STMNT:{rules:[27],inclusive:!1},CLASSDEFID:{rules:[22],inclusive:!1},CLASSDEF:{rules:[20,21],inclusive:!1},CLASS_STYLE:{rules:[25],inclusive:!1},CLASS:{rules:[24],inclusive:!1},LLABEL:{rules:[99,100,101,102,103],inclusive:!1},ARROW_DIR:{rules:[85,86,87,88,89,90,91],inclusive:!1},BLOCK_ARROW:{rules:[76,81,84],inclusive:!1},NODE:{rules:[37,38,39,40,41,42,43,44,45,46,47,48,49,50,51,52,53,77,80],inclusive:!1},md_string:{rules:[9,10,78,79],inclusive:!1},space:{rules:[],inclusive:!1},string:{rules:[12,13,82,83],inclusive:!1},acc_descr_multiline:{rules:[34,35],inclusive:!1},acc_descr:{rules:[32],inclusive:!1},acc_title:{rules:[30],inclusive:!1},INITIAL:{rules:[0,1,2,3,4,5,6,7,8,11,14,15,16,17,18,19,23,26,29,31,33,36,54,55,56,57,58,59,60,61,62,63,64,65,66,67,68,69,70,71,72,73,74,75,92,93,94,95,96,97,98,104],inclusive:!0}}};return e}();y.lexer=x;function k(){this.yy={}}t(k,"Parser");k.prototype=y;y.Parser=k;return new k}();R.parser=R;var E=new Map;var H=[];var D=new Map;var F="color";var J="fill";var C="bgFill";var T=",";var P=n();var N=new Map;var G=t(e=>i.sanitizeText(e,P),"sanitizeText");var I=t(function(e,t=""){let n=N.get(e);if(!n){n={id:e,styles:[],textStyles:[]};N.set(e,n)}t!==void 0&&t!==null&&t.split(T).forEach(e=>{const t=e.replace(/([^;]*);/,"$1").trim();if(RegExp(F).exec(e)){let e=t.replace(J,C),i=e.replace(F,J);n.textStyles.push(i)}n.styles.push(t)})},"addStyleClass");var O=t(function(e,t=""){const n=E.get(e);t!==void 0&&t!==null&&(n.styles=t.split(T))},"addStyle2Node");var z=t(function(e,t){e.split(",").forEach(function(e){let n=E.get(e);if(n===void 0){let t=e.trim();n={id:t,type:"na",children:[]};E.set(t,n)}n.classes||(n.classes=[]);n.classes.push(t)})},"setCssClass");var Y=t((e,t)=>{var n,i,r,s,l;const d=e.flat();const c=[];const h=d.find(e=>(e===null||e===void 0?void 0:e.type)==="column-setting");const _=(n=h===null||h===void 0?void 0:h.columns)!==null&&n!==void 0?n:-1;for(const e of d){typeof _==="number"&&_>0&&e.type!=="column-setting"&&typeof e.widthInColumns==="number"&&e.widthInColumns>_&&a.warn(`Block ${e.id} width ${e.widthInColumns} exceeds configured column width ${_}`);e.label&&(e.label=G(e.label));if(e.type==="classDef"){I(e.id,e.css);continue}if(e.type==="applyClass"){z(e.id,(i=e===null||e===void 0?void 0:e.styleClass)!==null&&i!==void 0?i:"");continue}if(e.type==="applyStyles"){(e===null||e===void 0?void 0:e.stylesStr)&&O(e.id,e===null||e===void 0?void 0:e.stylesStr);continue}if(e.type==="column-setting"){t.columns=(r=e.columns)!==null&&r!==void 0?r:-1}else if(e.type==="edge"){let t=((s=D.get(e.id))!==null&&s!==void 0?s:0)+1;D.set(e.id,t);e.id=t+"-"+e.id;H.push(e)}else{if(!e.label){if(e.type==="composite"){e.label=""}else{e.label=e.id}}let t=E.get(e.id);if(t===void 0){E.set(e.id,e)}else{e.type!=="na"&&(t.type=e.type);e.label!==e.id&&(t.label=e.label)}e.children&&Y(e.children,e);if(e.type==="space"){let t=(l=e.width)!==null&&l!==void 0?l:1;for(let n=0;n<t;n++){let t=o(e);t.id=t.id+"-"+n;E.set(t.id,t);c.push(t)}}else t===void 0&&c.push(e)}}t.children=c},"populateBlockDatabase");var W=[];var M={id:"root",type:"composite",children:[],columns:-1};var K=t(()=>{a.debug("Clear called");r();M={id:"root",type:"composite",children:[],columns:-1};E=new Map([["root",M]]);W=[];N=new Map;H=[];D=new Map},"clear");function V(e){a.debug("typeStr2Type",e);switch(e){case"[]":return"square";case"()":a.debug("we have a round");return"round";case"(())":return"circle";case">]":return"rect_left_inv_arrow";case"{}":return"diamond";case"{{}}":return"hexagon";case"([])":return"stadium";case"[[]]":return"subroutine";case"[()]":return"cylinder";case"((()))":return"doublecircle";case"[//]":return"lean_right";case"[\\\\]":return"lean_left";case"[/\\]":return"trapezoid";case"[\\/]":return"inv_trapezoid";case"<[]>":return"block_arrow";default:return"na"}}t(V,"typeStr2Type");function X(e){a.debug("typeStr2Type",e);switch(e){case"==":return"thick";default:return"normal"}}t(X,"edgeTypeStr2Type");function Z(e){switch(e.replace(/^[\s-]+|[\s-]+$/g,"")){case"x":return"arrow_cross";case"o":return"arrow_circle";case">":return"arrow_point";default:return""}}t(Z,"edgeStrToEdgeData");var q=0;var j=t(()=>{q++;return"id-"+Math.random().toString(36).substr(2,12)+"-"+q},"generateId");var U=t(e=>{M.children=e;Y(e,M);W=M.children},"setHierarchy");var Q=t(e=>{const t=E.get(e);if(!t){return-1}if(t.columns){return t.columns}if(!t.children){return-1}return t.children.length},"getColumns");var ee=t(()=>[...E.values()],"getBlocksFlat");var te=t(()=>W||[],"getBlocks");var ne=t(()=>H,"getEdges");var ie=t(e=>E.get(e),"getBlock");var ae=t(e=>{E.set(e.id,e)},"setBlock");var oe=t(()=>a,"getLogger");var re=t(function(){return N},"getClasses");var se={getConfig:t(()=>s().block,"getConfig"),typeStr2Type:V,edgeTypeStr2Type:X,edgeStrToEdgeData:Z,getLogger:oe,getBlocksFlat:ee,getBlocks:te,getEdges:ne,setHierarchy:U,getBlock:ie,setBlock:ae,getColumns:Q,getClasses:re,clear:K,generateId:j};var le=t((e,t)=>{const n=l(e,"r");const i=l(e,"g");const a=l(e,"b");return d(n,i,a,t)},"fade");var de=t(e=>`.label {\n    font-family: ${e.fontFamily};\n    color: ${e.nodeTextColor||e.textColor};\n  }\n  .cluster-label text {\n    fill: ${e.titleColor};\n  }\n  .cluster-label span,p {\n    color: ${e.titleColor};\n  }\n\n\n\n  .label text,span,p {\n    fill: ${e.nodeTextColor||e.textColor};\n    color: ${e.nodeTextColor||e.textColor};\n  }\n\n  .node rect,\n  .node circle,\n  .node ellipse,\n  .node polygon,\n  .node path {\n    fill: ${e.mainBkg};\n    stroke: ${e.nodeBorder};\n    stroke-width: 1px;\n  }\n  .flowchart-label text {\n    text-anchor: middle;\n  }\n  // .flowchart-label .text-outer-tspan {\n  //   text-anchor: middle;\n  // }\n  // .flowchart-label .text-inner-tspan {\n  //   text-anchor: start;\n  // }\n\n  .node .label {\n    text-align: center;\n  }\n  .node.clickable {\n    cursor: pointer;\n  }\n\n  .arrowheadPath {\n    fill: ${e.arrowheadColor};\n  }\n\n  .edgePath .path {\n    stroke: ${e.lineColor};\n    stroke-width: 2.0px;\n  }\n\n  .flowchart-link {\n    stroke: ${e.lineColor};\n    fill: none;\n  }\n\n  .edgeLabel {\n    background-color: ${e.edgeLabelBackground};\n    rect {\n      opacity: 0.5;\n      background-color: ${e.edgeLabelBackground};\n      fill: ${e.edgeLabelBackground};\n    }\n    text-align: center;\n  }\n\n  /* For html labels only */\n  .labelBkg {\n    background-color: ${le(e.edgeLabelBackground,.5)};\n    // background-color:\n  }\n\n  .node .cluster {\n    // fill: ${le(e.mainBkg,.5)};\n    fill: ${le(e.clusterBkg,.5)};\n    stroke: ${le(e.clusterBorder,.2)};\n    box-shadow: rgba(50, 50, 93, 0.25) 0px 13px 27px -5px, rgba(0, 0, 0, 0.3) 0px 8px 16px -8px;\n    stroke-width: 1px;\n  }\n\n  .cluster text {\n    fill: ${e.titleColor};\n  }\n\n  .cluster span,p {\n    color: ${e.titleColor};\n  }\n  /* .cluster div {\n    color: ${e.titleColor};\n  } */\n\n  div.mermaidTooltip {\n    position: absolute;\n    text-align: center;\n    max-width: 200px;\n    padding: 2px;\n    font-family: ${e.fontFamily};\n    font-size: 12px;\n    background: ${e.tertiaryColor};\n    border: 1px solid ${e.border2};\n    border-radius: 2px;\n    pointer-events: none;\n    z-index: 100;\n  }\n\n  .flowchartTitleText {\n    text-anchor: middle;\n    font-size: 18px;\n    fill: ${e.textColor};\n  }\n  ${c()}\n`,"getStyles");var ce=t((e,t,n,i)=>{t.forEach(t=>{me[t](e,n,i)})},"insertMarkers");var he=t((e,t,n)=>{a.trace("Making markers for ",n);e.append("defs").append("marker").attr("id",n+"_"+t+"-extensionStart").attr("class","marker extension "+t).attr("refX",18).attr("refY",7).attr("markerWidth",190).attr("markerHeight",240).attr("orient","auto").append("path").attr("d","M 1,7 L18,13 V 1 Z");e.append("defs").append("marker").attr("id",n+"_"+t+"-extensionEnd").attr("class","marker extension "+t).attr("refX",1).attr("refY",7).attr("markerWidth",20).attr("markerHeight",28).attr("orient","auto").append("path").attr("d","M 1,1 V 13 L18,7 Z")},"extension");var _e=t((e,t,n)=>{e.append("defs").append("marker").attr("id",n+"_"+t+"-compositionStart").attr("class","marker composition "+t).attr("refX",18).attr("refY",7).attr("markerWidth",190).attr("markerHeight",240).attr("orient","auto").append("path").attr("d","M 18,7 L9,13 L1,7 L9,1 Z");e.append("defs").append("marker").attr("id",n+"_"+t+"-compositionEnd").attr("class","marker composition "+t).attr("refX",1).attr("refY",7).attr("markerWidth",20).attr("markerHeight",28).attr("orient","auto").append("path").attr("d","M 18,7 L9,13 L1,7 L9,1 Z")},"composition")
var ge=t((e,t,n)=>{e.append("defs").append("marker").attr("id",n+"_"+t+"-aggregationStart").attr("class","marker aggregation "+t).attr("refX",18).attr("refY",7).attr("markerWidth",190).attr("markerHeight",240).attr("orient","auto").append("path").attr("d","M 18,7 L9,13 L1,7 L9,1 Z");e.append("defs").append("marker").attr("id",n+"_"+t+"-aggregationEnd").attr("class","marker aggregation "+t).attr("refX",1).attr("refY",7).attr("markerWidth",20).attr("markerHeight",28).attr("orient","auto").append("path").attr("d","M 18,7 L9,13 L1,7 L9,1 Z")},"aggregation");var pe=t((e,t,n)=>{e.append("defs").append("marker").attr("id",n+"_"+t+"-dependencyStart").attr("class","marker dependency "+t).attr("refX",6).attr("refY",7).attr("markerWidth",190).attr("markerHeight",240).attr("orient","auto").append("path").attr("d","M 5,7 L9,13 L1,7 L9,1 Z");e.append("defs").append("marker").attr("id",n+"_"+t+"-dependencyEnd").attr("class","marker dependency "+t).attr("refX",13).attr("refY",7).attr("markerWidth",20).attr("markerHeight",28).attr("orient","auto").append("path").attr("d","M 18,7 L9,13 L14,7 L9,1 Z")},"dependency");var be=t((e,t,n)=>{e.append("defs").append("marker").attr("id",n+"_"+t+"-lollipopStart").attr("class","marker lollipop "+t).attr("refX",13).attr("refY",7).attr("markerWidth",190).attr("markerHeight",240).attr("orient","auto").append("circle").attr("stroke","black").attr("fill","transparent").attr("cx",7).attr("cy",7).attr("r",6);e.append("defs").append("marker").attr("id",n+"_"+t+"-lollipopEnd").attr("class","marker lollipop "+t).attr("refX",1).attr("refY",7).attr("markerWidth",190).attr("markerHeight",240).attr("orient","auto").append("circle").attr("stroke","black").attr("fill","transparent").attr("cx",7).attr("cy",7).attr("r",6)},"lollipop");var ue=t((e,t,n)=>{e.append("marker").attr("id",n+"_"+t+"-pointEnd").attr("class","marker "+t).attr("viewBox","0 0 10 10").attr("refX",6).attr("refY",5).attr("markerUnits","userSpaceOnUse").attr("markerWidth",12).attr("markerHeight",12).attr("orient","auto").append("path").attr("d","M 0 0 L 10 5 L 0 10 z").attr("class","arrowMarkerPath").style("stroke-width",1).style("stroke-dasharray","1,0");e.append("marker").attr("id",n+"_"+t+"-pointStart").attr("class","marker "+t).attr("viewBox","0 0 10 10").attr("refX",4.5).attr("refY",5).attr("markerUnits","userSpaceOnUse").attr("markerWidth",12).attr("markerHeight",12).attr("orient","auto").append("path").attr("d","M 0 5 L 10 10 L 10 0 z").attr("class","arrowMarkerPath").style("stroke-width",1).style("stroke-dasharray","1,0")},"point");var ye=t((e,t,n)=>{e.append("marker").attr("id",n+"_"+t+"-circleEnd").attr("class","marker "+t).attr("viewBox","0 0 10 10").attr("refX",11).attr("refY",5).attr("markerUnits","userSpaceOnUse").attr("markerWidth",11).attr("markerHeight",11).attr("orient","auto").append("circle").attr("cx","5").attr("cy","5").attr("r","5").attr("class","arrowMarkerPath").style("stroke-width",1).style("stroke-dasharray","1,0");e.append("marker").attr("id",n+"_"+t+"-circleStart").attr("class","marker "+t).attr("viewBox","0 0 10 10").attr("refX",-1).attr("refY",5).attr("markerUnits","userSpaceOnUse").attr("markerWidth",11).attr("markerHeight",11).attr("orient","auto").append("circle").attr("cx","5").attr("cy","5").attr("r","5").attr("class","arrowMarkerPath").style("stroke-width",1).style("stroke-dasharray","1,0")},"circle");var xe=t((e,t,n)=>{e.append("marker").attr("id",n+"_"+t+"-crossEnd").attr("class","marker cross "+t).attr("viewBox","0 0 11 11").attr("refX",12).attr("refY",5.2).attr("markerUnits","userSpaceOnUse").attr("markerWidth",11).attr("markerHeight",11).attr("orient","auto").append("path").attr("d","M 1,1 l 9,9 M 10,1 l -9,9").attr("class","arrowMarkerPath").style("stroke-width",2).style("stroke-dasharray","1,0");e.append("marker").attr("id",n+"_"+t+"-crossStart").attr("class","marker cross "+t).attr("viewBox","0 0 11 11").attr("refX",-1).attr("refY",5.2).attr("markerUnits","userSpaceOnUse").attr("markerWidth",11).attr("markerHeight",11).attr("orient","auto").append("path").attr("d","M 1,1 l 9,9 M 10,1 l -9,9").attr("class","arrowMarkerPath").style("stroke-width",2).style("stroke-dasharray","1,0")},"cross");var ke=t((e,t,n)=>{e.append("defs").append("marker").attr("id",n+"_"+t+"-barbEnd").attr("refX",19).attr("refY",7).attr("markerWidth",20).attr("markerHeight",14).attr("markerUnits","strokeWidth").attr("orient","auto").append("path").attr("d","M 19,7 L9,13 L14,7 L9,1 Z")},"barb");var me={extension:he,composition:_e,aggregation:ge,dependency:pe,lollipop:be,point:ue,circle:ye,cross:xe,barb:ke};var fe=(A=($=(L=n())===null||L===void 0?void 0:L.block)===null||$===void 0?void 0:$.padding)!==null&&A!==void 0?A:8;function ve(e,t){if(e===0||!Number.isInteger(e)){throw new Error("Columns must be an integer !== 0.")}if(t<0||!Number.isInteger(t)){throw new Error("Position must be a non-negative integer."+t)}if(e<0){return{px:t,py:0}}if(e===1){return{px:0,py:t}}const n=t%e;const i=Math.floor(t/e);return{px:n,py:i}}t(ve,"calculateBlockPosition");var we=t(e=>{var t,n;let i=0;let o=0;for(const r of e.children){let{width:s,height:l,x:d,y:c}=(t=r.size)!==null&&t!==void 0?t:{width:0,height:0,x:0,y:0};a.debug("getMaxChildSize abc95 child:",r.id,"width:",s,"height:",l,"x:",d,"y:",c,r.type);if(r.type==="space"){continue}s>i&&(i=s/((n=e.widthInColumns)!==null&&n!==void 0?n:1));l>o&&(o=l)}return{width:i,height:o}},"getMaxChildSize");function Se(e,t,n=0,i=0){var o,r,s,l,d,c,h,_,g,p,b,u,y,x,k;a.debug("setBlockSizes abc95 (start)",e.id,(o=e===null||e===void 0?void 0:e.size)===null||o===void 0?void 0:o.x,"block width =",e===null||e===void 0?void 0:e.size,"siblingWidth",n);((r=e===null||e===void 0?void 0:e.size)===null||r===void 0?void 0:r.width)||(e.size={width:n,height:i,x:0,y:0});let m=0;let f=0;if(((s=e.children)===null||s===void 0?void 0:s.length)>0){for(const n of e.children){Se(n,t)}let o=we(e);m=o.width;f=o.height;a.debug("setBlockSizes abc95 maxWidth of",e.id,":s children is ",m,f);for(const t of e.children){if(t.size){a.debug(`abc95 Setting size of children of ${e.id} id=${t.id} ${m} ${f} ${JSON.stringify(t.size)}`);t.size.width=m*((l=t.widthInColumns)!==null&&l!==void 0?l:1)+fe*(((d=t.widthInColumns)!==null&&d!==void 0?d:1)-1);t.size.height=f;t.size.x=0;t.size.y=0;a.debug(`abc95 updating size of ${e.id} children child:${t.id} maxWidth:${m} maxHeight:${f}`)}}for(const n of e.children){Se(n,t,m,f)}let r=(c=e.columns)!==null&&c!==void 0?c:-1,s=0;for(const t of e.children){s+=(h=t.widthInColumns)!==null&&h!==void 0?h:1}let u=e.children.length;r>0&&r<s&&(u=r);let y=Math.ceil(s/u),x=u*(m+fe)+fe,k=y*(f+fe)+fe;if(x<n){a.debug(`Detected to small sibling: abc95 ${e.id} siblingWidth ${n} siblingHeight ${i} width ${x}`);x=n;k=i;let t=(n-u*fe-fe)/u,o=(i-y*fe-fe)/y;a.debug("Size indata abc88",e.id,"childWidth",t,"maxWidth",m);a.debug("Size indata abc88",e.id,"childHeight",o,"maxHeight",f);a.debug("Size indata abc88 xSize",u,"padding",fe);for(const n of e.children){if(n.size){n.size.width=t;n.size.height=o;n.size.x=0;n.size.y=0}}}a.debug(`abc95 (finale calc) ${e.id} xSize ${u} ySize ${y} columns ${r}${e.children.length} width=${Math.max(x,((_=e.size)===null||_===void 0?void 0:_.width)||0)}`);if(x<(((g=e===null||e===void 0?void 0:e.size)===null||g===void 0?void 0:g.width)||0)){x=((p=e===null||e===void 0?void 0:e.size)===null||p===void 0?void 0:p.width)||0;let t=r>0?Math.min(e.children.length,r):e.children.length;if(t>0){let n=(x-t*fe-fe)/t;a.debug("abc95 (growing to fit) width",e.id,x,(b=e.size)===null||b===void 0?void 0:b.width,n);for(const t of e.children){t.size&&(t.size.width=n)}}}e.size={width:x,height:k,x:0,y:0}}a.debug("setBlockSizes abc94 (done)",e.id,(u=e===null||e===void 0?void 0:e.size)===null||u===void 0?void 0:u.x,(y=e===null||e===void 0?void 0:e.size)===null||y===void 0?void 0:y.width,(x=e===null||e===void 0?void 0:e.size)===null||x===void 0?void 0:x.y,(k=e===null||e===void 0?void 0:e.size)===null||k===void 0?void 0:k.height)}t(Se,"setBlockSizes");function Be(e,t){var n,i,o,r,s,l,d,c,h,_,g,p,b,u,y,x,k,m,f,v,w,S;a.debug(`abc85 layout blocks (=>layoutBlocks) ${e.id} x: ${(n=e===null||e===void 0?void 0:e.size)===null||n===void 0?void 0:n.x} y: ${(i=e===null||e===void 0?void 0:e.size)===null||i===void 0?void 0:i.y} width: ${(o=e===null||e===void 0?void 0:e.size)===null||o===void 0?void 0:o.width}`);const B=(r=e.columns)!==null&&r!==void 0?r:-1;a.debug("layoutBlocks columns abc95",e.id,"=>",B,e);if(e.children&&e.children.length>0){let n=(d=(l=(s=e===null||e===void 0?void 0:e.children[0])===null||s===void 0?void 0:s.size)===null||l===void 0?void 0:l.width)!==null&&d!==void 0?d:0,i=e.children.length*n+(e.children.length-1)*fe;a.debug("widthOfChildren 88",i,"posX");let o=0;a.debug("abc91 block?.size?.x",e.id,(c=e===null||e===void 0?void 0:e.size)===null||c===void 0?void 0:c.x);let r=((h=e===null||e===void 0?void 0:e.size)===null||h===void 0?void 0:h.x)?((_=e===null||e===void 0?void 0:e.size)===null||_===void 0?void 0:_.x)+(-((g=e===null||e===void 0?void 0:e.size)===null||g===void 0?void 0:g.width)/2||0):-fe,v=0;for(const n of e.children){let i=e;if(!n.size){continue}let{width:s,height:l}=n.size,{px:d,py:c}=ve(B,o);if(c!=v){v=c;r=((p=e===null||e===void 0?void 0:e.size)===null||p===void 0?void 0:p.x)?((b=e===null||e===void 0?void 0:e.size)===null||b===void 0?void 0:b.x)+(-((u=e===null||e===void 0?void 0:e.size)===null||u===void 0?void 0:u.width)/2||0):-fe;a.debug("New row in layout for block",e.id," and child ",n.id,v)}a.debug(`abc89 layout blocks (child) id: ${n.id} Pos: ${o} (px, py) ${d},${c} (${(y=i===null||i===void 0?void 0:i.size)===null||y===void 0?void 0:y.x},${(x=i===null||i===void 0?void 0:i.size)===null||x===void 0?void 0:x.y}) parent: ${i.id} width: ${s}${fe}`);if(i.size){let e=s/2;n.size.x=r+fe+e;a.debug(`abc91 layout blocks (calc) px, pyid:${n.id} startingPos=X${r} new startingPosX${n.size.x} ${e} padding=${fe} width=${s} halfWidth=${e} => x:${n.size.x} y:${n.size.y} ${n.widthInColumns} (width * (child?.w || 1)) / 2 ${s*((k=n===null||n===void 0?void 0:n.widthInColumns)!==null&&k!==void 0?k:1)/2}`);r=n.size.x+e;n.size.y=i.size.y-i.size.height/2+c*(l+fe)+l/2+fe;a.debug(`abc88 layout blocks (calc) px, pyid:${n.id}startingPosX${r}${fe}${e}=>x:${n.size.x}y:${n.size.y}${n.widthInColumns}(width * (child?.w || 1)) / 2${s*((m=n===null||n===void 0?void 0:n.widthInColumns)!==null&&m!==void 0?m:1)/2}`)}n.children&&Be(n,t);let h=(f=n===null||n===void 0?void 0:n.widthInColumns)!==null&&f!==void 0?f:1;B>0&&(h=Math.min(h,B-o%B));o+=h;a.debug("abc88 columnsPos",n,o)}}a.debug(`layout blocks (<==layoutBlocks) ${e.id} x: ${(v=e===null||e===void 0?void 0:e.size)===null||v===void 0?void 0:v.x} y: ${(w=e===null||e===void 0?void 0:e.size)===null||w===void 0?void 0:w.y} width: ${(S=e===null||e===void 0?void 0:e.size)===null||S===void 0?void 0:S.width}`)}t(Be,"layoutBlocks");function Le(e,{minX:t,minY:n,maxX:i,maxY:a}={minX:0,minY:0,maxX:0,maxY:0}){if(e.size&&e.id!=="root"){let{x:o,y:r,width:s,height:l}=e.size;o-s/2<t&&(t=o-s/2);r-l/2<n&&(n=r-l/2);o+s/2>i&&(i=o+s/2);r+l/2>a&&(a=r+l/2)}if(e.children){for(const o of e.children){({minX:t,minY:n,maxX:i,maxY:a}=Le(o,{minX:t,minY:n,maxX:i,maxY:a}))}}return{minX:t,minY:n,maxX:i,maxY:a}}t(Le,"findBounds");function $e(e){const t=e.getBlock("root");if(!t){return}Se(t,e,0,0);Be(t,e);a.debug("getBlocks",JSON.stringify(t,null,2));const{minX:n,minY:i,maxX:o,maxY:r}=Le(t);const s=r-i;const l=o-n;return{x:n,y:i,width:l,height:s}}t($e,"layout");function Ae(e,t){t&&e.attr("style",t)}t(Ae,"applyStyle");function Re(e,t){const n=h(document.createElementNS("http://www.w3.org/2000/svg","foreignObject"));const i=n.append("xhtml:div");const a=e.label;const o=e.isNode?"nodeLabel":"edgeLabel";const r=i.append("span");r.html(_(a,t));Ae(r,e.labelStyle);r.attr("class",o);Ae(i,e.labelStyle);i.style("display","inline-block");i.style("white-space","nowrap");i.attr("xmlns","http://www.w3.org/1999/xhtml");return n.node()}t(Re,"addHtmlLabel");var Ee=t(async(e,t,i,o)=>{let r=e||"";typeof r==="object"&&(r=r[0]);const s=n();if(g(s.flowchart.htmlLabels)){r=r.replace(/\\n|\n/g,"<br />");a.debug("vertexText"+r);let e=await p(b(r)),n={isNode:o,label:e,labelStyle:t.replace("fill:","color:")},i=Re(n,s);return i}else{let e=document.createElementNS("http://www.w3.org/2000/svg","text");e.setAttribute("style",t.replace("color:","fill:"));let n=[];if(typeof r==="string"){n=r.split(/\\n|\n|<br\s*\/?>/gi)}else if(Array.isArray(r)){n=r}else{n=[]}for(const t of n){let n=document.createElementNS("http://www.w3.org/2000/svg","tspan");n.setAttributeNS("http://www.w3.org/XML/1998/namespace","xml:space","preserve");n.setAttribute("dy","1em");n.setAttribute("x","0");if(i){n.setAttribute("class","title-row")}else{n.setAttribute("class","row")}n.textContent=t.trim();e.appendChild(n)}return e}},"createLabel");var He=t((e,t,n,i,a)=>{t.arrowTypeStart&&Fe(e,"start",t.arrowTypeStart,n,i,a);t.arrowTypeEnd&&Fe(e,"end",t.arrowTypeEnd,n,i,a)},"addEdgeMarkers");var De={arrow_cross:"cross",arrow_point:"point",arrow_barb:"barb",arrow_circle:"circle",aggregation:"aggregation",extension:"extension",composition:"composition",dependency:"dependency",lollipop:"lollipop"};var Fe=t((e,t,n,i,o,r)=>{const s=De[n];if(!s){a.warn(`Unknown arrow type: ${n}`);return}const l=t==="start"?"Start":"End";e.attr(`marker-${t}`,`url(${i}#${o}_${r}-${s}${l})`)},"addEdgeMarker");var Je={};var Ce={};var Te=t(async(e,t)=>{const i=n();const a=g(i.flowchart.htmlLabels);const o=t.labelType==="markdown"?u(e,t.label,{style:t.labelStyle,useHtmlLabels:a,addSvgBackground:!0},i):await Ee(t.label,t.labelStyle);const r=e.insert("g").attr("class","edgeLabel");const s=r.insert("g").attr("class","label");s.node().appendChild(o);let l=o.getBBox();if(a){let e=o.children[0],t=h(o);l=e.getBoundingClientRect();t.attr("width",l.width);t.attr("height",l.height)}s.attr("transform","translate("+-l.width/2+", "+-l.height/2+")");Je[t.id]=r;t.width=l.width;t.height=l.height;let d;if(t.startLabelLeft){let n=await Ee(t.startLabelLeft,t.labelStyle),i=e.insert("g").attr("class","edgeTerminals"),a=i.insert("g").attr("class","inner");d=a.node().appendChild(n);let o=n.getBBox();a.attr("transform","translate("+-o.width/2+", "+-o.height/2+")");Ce[t.id]||(Ce[t.id]={});Ce[t.id].startLeft=i;Pe(d,t.startLabelLeft)}if(t.startLabelRight){let n=await Ee(t.startLabelRight,t.labelStyle),i=e.insert("g").attr("class","edgeTerminals"),a=i.insert("g").attr("class","inner");d=i.node().appendChild(n);a.node().appendChild(n);let o=n.getBBox();a.attr("transform","translate("+-o.width/2+", "+-o.height/2+")");Ce[t.id]||(Ce[t.id]={});Ce[t.id].startRight=i;Pe(d,t.startLabelRight)}if(t.endLabelLeft){let n=await Ee(t.endLabelLeft,t.labelStyle),i=e.insert("g").attr("class","edgeTerminals"),a=i.insert("g").attr("class","inner");d=a.node().appendChild(n);let o=n.getBBox();a.attr("transform","translate("+-o.width/2+", "+-o.height/2+")");i.node().appendChild(n);Ce[t.id]||(Ce[t.id]={});Ce[t.id].endLeft=i;Pe(d,t.endLabelLeft)}if(t.endLabelRight){let n=await Ee(t.endLabelRight,t.labelStyle),i=e.insert("g").attr("class","edgeTerminals"),a=i.insert("g").attr("class","inner");d=a.node().appendChild(n);let o=n.getBBox();a.attr("transform","translate("+-o.width/2+", "+-o.height/2+")");i.node().appendChild(n);Ce[t.id]||(Ce[t.id]={});Ce[t.id].endRight=i;Pe(d,t.endLabelRight)}return o},"insertEdgeLabel");function Pe(e,t){if(n().flowchart.htmlLabels&&e){e.style.width=t.length*9+"px";e.style.height="12px"}}t(Pe,"setTerminalWidth");var Ne=t((e,t)=>{a.debug("Moving label abc88 ",e.id,e.label,Je[e.id],t);let i=t.updatedPath?t.updatedPath:t.originalPath;const o=n();const{subGraphTitleTotalMargin:r}=y(o);if(e.label){let n=Je[e.id],o=e.x,s=e.y;if(i){let n=x.calcLabelPosition(i);a.debug("Moving label "+e.label+" from (",o,",",s,") to (",n.x,",",n.y,") abc88");if(t.updatedPath){o=n.x;s=n.y}}n.attr("transform",`translate(${o}, ${s+r/2})`)}if(e.startLabelLeft){let t=Ce[e.id].startLeft,n=e.x,a=e.y;if(i){let t=x.calcTerminalLabelPosition(e.arrowTypeStart?10:0,"start_left",i);n=t.x;a=t.y}t.attr("transform",`translate(${n}, ${a})`)}if(e.startLabelRight){let t=Ce[e.id].startRight,n=e.x,a=e.y;if(i){let t=x.calcTerminalLabelPosition(e.arrowTypeStart?10:0,"start_right",i);n=t.x;a=t.y}t.attr("transform",`translate(${n}, ${a})`)}if(e.endLabelLeft){let t=Ce[e.id].endLeft,n=e.x,a=e.y;if(i){let t=x.calcTerminalLabelPosition(e.arrowTypeEnd?10:0,"end_left",i);n=t.x;a=t.y}t.attr("transform",`translate(${n}, ${a})`)}if(e.endLabelRight){let t=Ce[e.id].endRight,n=e.x,a=e.y;if(i){let t=x.calcTerminalLabelPosition(e.arrowTypeEnd?10:0,"end_right",i);n=t.x;a=t.y}t.attr("transform",`translate(${n}, ${a})`)}},"positionEdgeLabel");var Ge=t((e,t)=>{const n=e.x;const i=e.y;const a=Math.abs(t.x-n);const o=Math.abs(t.y-i);const r=e.width/2;const s=e.height/2;if(a>=r||o>=s){return!0}return!1},"outsideNode");var Ie=t((e,t,n)=>{a.debug(`intersection calc abc89:\n  outsidePoint: ${JSON.stringify(t)}\n  insidePoint : ${JSON.stringify(n)}\n  node        : x:${e.x} y:${e.y} w:${e.width} h:${e.height}`);const i=e.x;const o=e.y;const r=Math.abs(i-n.x);const s=e.width/2;let l=n.x<t.x?s-r:s+r;const d=e.height/2;const c=Math.abs(t.y-n.y);const h=Math.abs(t.x-n.x);if(Math.abs(o-t.y)*s>Math.abs(i-t.x)*d){let e=n.y<t.y?t.y-d-o:o-d-t.y;l=h*e/c;let i={x:n.x<t.x?n.x+l:n.x-h+l,y:n.y<t.y?n.y+c-e:n.y-c+e};if(l===0){i.x=t.x;i.y=t.y}h===0&&(i.x=t.x);c===0&&(i.y=t.y);a.debug(`abc89 topp/bott calc, Q ${c}, q ${e}, R ${h}, r ${l}`,i);return i}else{if(n.x<t.x){l=t.x-s-i}else{l=i-s-t.x}let e=c*l/h,o=n.x<t.x?n.x+h-l:n.x-h+l,r=n.y<t.y?n.y+e:n.y-e;a.debug(`sides calc abc89, Q ${c}, q ${e}, R ${h}, r ${l}`,{_x:o,_y:r});if(l===0){o=t.x;r=t.y}h===0&&(o=t.x);c===0&&(r=t.y);return{x:o,y:r}}},"intersection");var Oe=t((e,t)=>{a.debug("abc88 cutPathAtIntersect",e,t);let n=[];let i=e[0];let o=!1;e.forEach(e=>{if(!Ge(t,e)&&!o){let a=Ie(t,i,e),r=!1;n.forEach(e=>{r=r||e.x===a.x&&e.y===a.y});n.some(e=>e.x===a.x&&e.y===a.y)||n.push(a);o=!0}else{i=e;o||n.push(e)}});return n},"cutPathAtIntersect");var ze=t(function(e,t,i,o,r,s,l){let d=i.points;a.debug("abc88 InsertEdge: edge=",i,"e=",t);let c=!1;const h=s.node(t.v);var _=s.node(t.w);if((_===null||_===void 0?void 0:_.intersect)&&(h===null||h===void 0?void 0:h.intersect)){d=d.slice(1,i.points.length-1);d.unshift(h.intersect(d[0]));d.push(_.intersect(d[d.length-1]))}if(i.toCluster){a.debug("to cluster abc88",o[i.toCluster]);d=Oe(i.points,o[i.toCluster].node);c=!0}if(i.fromCluster){a.debug("from cluster abc88",o[i.fromCluster]);d=Oe(d.reverse(),o[i.fromCluster].node).reverse();c=!0}const g=d.filter(e=>!Number.isNaN(e.y));let p=k;i.curve&&(r==="graph"||r==="flowchart")&&(p=i.curve);const{x:b,y:u}=m(i);const y=f().x(b).y(u).curve(p);let x;switch(i.thickness){case"normal":x="edge-thickness-normal";break;case"thick":x="edge-thickness-thick";break;case"invisible":x="edge-thickness-thick";break;default:x=""}switch(i.pattern){case"solid":x+=" edge-pattern-solid";break;case"dotted":x+=" edge-pattern-dotted";break;case"dashed":x+=" edge-pattern-dashed";break}const w=e.append("path").attr("d",y(g)).attr("id",i.id).attr("class"," "+x+(i.classes?" "+i.classes:"")).attr("style",i.style);let S="";(n().flowchart.arrowMarkerAbsolute||n().state.arrowMarkerAbsolute)&&(S=v(!0));He(w,i,S,l,r);let B={};c&&(B.updatedPath=d);B.originalPath=i.points;return B},"insertEdge");var Ye=t(e=>{const t=new Set;for(const n of e){switch(n){case"x":t.add("right");t.add("left");break;case"y":t.add("up");t.add("down");break;default:t.add(n);break}}return t},"expandAndDeduplicateDirections");var We=t((e,t,n)=>{const i=Ye(e);const a=2;const o=t.height+2*n.padding;const r=o/a;const s=t.width+2*r+n.padding;const l=n.padding/2;if(i.has("right")&&i.has("left")&&i.has("up")&&i.has("down")){return[{x:0,y:0},{x:r,y:0},{x:s/2,y:2*l},{x:s-r,y:0},{x:s,y:0},{x:s,y:-o/3},{x:s+2*l,y:-o/2},{x:s,y:-2*o/3},{x:s,y:-o},{x:s-r,y:-o},{x:s/2,y:-o-2*l},{x:r,y:-o},{x:0,y:-o},{x:0,y:-2*o/3},{x:-2*l,y:-o/2},{x:0,y:-o/3}]}if(i.has("right")&&i.has("left")&&i.has("up")){return[{x:r,y:0},{x:s-r,y:0},{x:s,y:-o/2},{x:s-r,y:-o},{x:r,y:-o},{x:0,y:-o/2}]}if(i.has("right")&&i.has("left")&&i.has("down")){return[{x:0,y:0},{x:r,y:-o},{x:s-r,y:-o},{x:s,y:0}]}if(i.has("right")&&i.has("up")&&i.has("down")){return[{x:0,y:0},{x:s,y:-r},{x:s,y:-o+r},{x:0,y:-o}]}if(i.has("left")&&i.has("up")&&i.has("down")){return[{x:s,y:0},{x:0,y:-r},{x:0,y:-o+r},{x:s,y:-o}]}if(i.has("right")&&i.has("left")){return[{x:r,y:0},{x:r,y:-l},{x:s-r,y:-l},{x:s-r,y:0},{x:s,y:-o/2},{x:s-r,y:-o},{x:s-r,y:-o+l},{x:r,y:-o+l},{x:r,y:-o},{x:0,y:-o/2}]}if(i.has("up")&&i.has("down")){return[{x:s/2,y:0},{x:0,y:-l},{x:r,y:-l},{x:r,y:-o+l},{x:0,y:-o+l},{x:s/2,y:-o},{x:s,y:-o+l},{x:s-r,y:-o+l},{x:s-r,y:-l},{x:s,y:-l}]}if(i.has("right")&&i.has("up")){return[{x:0,y:0},{x:s,y:-r},{x:0,y:-o}]}if(i.has("right")&&i.has("down")){return[{x:0,y:0},{x:s,y:0},{x:0,y:-o}]}if(i.has("left")&&i.has("up")){return[{x:s,y:0},{x:0,y:-r},{x:s,y:-o}]}if(i.has("left")&&i.has("down")){return[{x:s,y:0},{x:0,y:0},{x:s,y:-o}]}if(i.has("right")){return[{x:r,y:-l},{x:r,y:-l},{x:s-r,y:-l},{x:s-r,y:0},{x:s,y:-o/2},{x:s-r,y:-o},{x:s-r,y:-o+l},{x:r,y:-o+l},{x:r,y:-o+l}]}if(i.has("left")){return[{x:r,y:0},{x:r,y:-l},{x:s-r,y:-l},{x:s-r,y:-o+l},{x:r,y:-o+l},{x:r,y:-o},{x:0,y:-o/2}]}if(i.has("up")){return[{x:r,y:-l},{x:r,y:-o+l},{x:0,y:-o+l},{x:s/2,y:-o},{x:s,y:-o+l},{x:s-r,y:-o+l},{x:s-r,y:-l}]}if(i.has("down")){return[{x:s/2,y:0},{x:0,y:-l},{x:r,y:-l},{x:r,y:-o+l},{x:s-r,y:-o+l},{x:s-r,y:-l},{x:s,y:-l}]}return[{x:0,y:0}]},"getArrowPoints");function Me(e,t){return e.intersect(t)}t(Me,"intersectNode");function Ke(e,t,n,i){var a=e.x;var o=e.y;var r=a-i.x;var s=o-i.y;var l=Math.sqrt(t*t*s*s+n*n*r*r);var d=Math.abs(t*n*r/l);i.x<a&&(d=-d);var c=Math.abs(t*n*s/l);i.y<o&&(c=-c);return{x:a+d,y:o+c}}t(Ke,"intersectEllipse");function Ve(e,t,n){return Ke(e,t,t,n)}t(Ve,"intersectCircle");function Xe(e,t,n,i){var a,o,r,s,l,d;var c,h,_,g;var p,b,u;var y,x;a=t.y-e.y;r=e.x-t.x;l=t.x*e.y-e.x*t.y;_=a*n.x+r*n.y+l;g=a*i.x+r*i.y+l;if(_!==0&&g!==0&&Ze(_,g)){return}o=i.y-n.y;s=n.x-i.x;d=i.x*n.y-n.x*i.y;c=o*e.x+s*e.y+d;h=o*t.x+s*t.y+d;if(c!==0&&h!==0&&Ze(c,h)){return}p=a*s-o*r;if(p===0){return}b=Math.abs(p/2);u=r*d-s*l;y=u<0?(u-b)/p:(u+b)/p;u=o*l-a*d;x=u<0?(u-b)/p:(u+b)/p;return{x:y,y:x}}t(Xe,"intersectLine");function Ze(e,t){return e*t>0}t(Ze,"sameSign");function qe(e,t,n){var i=e.x;var a=e.y;var o=[];var r=Number.POSITIVE_INFINITY;var s=Number.POSITIVE_INFINITY;if(typeof t.forEach==="function"){t.forEach(function(e){r=Math.min(r,e.x);s=Math.min(s,e.y)})}else{r=Math.min(r,t.x);s=Math.min(s,t.y)}var l=i-e.width/2-r;var d=a-e.height/2-s;for(var c=0;c<t.length;c++){var h=t[c],_=t[c<t.length-1?c+1:0],g=Xe(e,n,{x:l+h.x,y:d+h.y},{x:l+_.x,y:d+_.y});g&&o.push(g)}if(!o.length){return e}o.length>1&&o.sort(function(e,t){var i=e.x-n.x;var a=e.y-n.y;var o=Math.sqrt(i*i+a*a);var r=t.x-n.x;var s=t.y-n.y;var l=Math.sqrt(r*r+s*s);return o<l?-1:o===l?0:1});return o[0]}t(qe,"intersectPolygon");var je=t((e,t)=>{var n=e.x;var i=e.y;var a=t.x-n;var o=t.y-i;var r=e.width/2;var s=e.height/2;var l,d;if(Math.abs(o)*r>Math.abs(a)*s){o<0&&(s=-s);l=o===0?0:s*a/o;d=s}else{a<0&&(r=-r);l=r;d=a===0?0:r*o/a}return{x:n+l,y:i+d}},"intersectRect");var Ue={node:Me,circle:Ve,ellipse:Ke,polygon:qe,rect:je};var Qe=t(async(e,i,a,o)=>{const r=n();let s;const l=i.useHtmlLabels||g(r.flowchart.htmlLabels);if(!a){s="node default"}else{s=a}const d=e.insert("g").attr("class",s).attr("id",i.domId||i.id);const c=d.insert("g").attr("class","label").attr("style",i.labelStyle);let p;if(i.labelText===void 0){p=""}else{p=typeof i.labelText==="string"?i.labelText:i.labelText[0]}const y=c.node();let x;if(i.labelType==="markdown"){x=u(c,_(b(p),r),{useHtmlLabels:l,width:i.width||r.flowchart.wrappingWidth,classes:"markdown-node-label"},r)}else{x=y.appendChild(await Ee(_(b(p),r),i.labelStyle,!1,o))}let k=x.getBBox();const m=i.padding/2;if(g(r.flowchart.htmlLabels)){let e=x.children[0],n=h(x),i=e.getElementsByTagName("img");if(i){let e=p.replace(/<img[^>]*>/g,"").trim()==="";await Promise.all([...i].map(n=>new Promise(i=>{function a(){n.style.display="flex";n.style.flexDirection="column";if(e){let e=r.fontSize?r.fontSize:window.getComputedStyle(document.body).fontSize,t=5,i=parseInt(e,10)*t+"px";n.style.minWidth=i;n.style.maxWidth=i}else{n.style.width="100%"}i(n)}t(a,"setupImage");setTimeout(()=>{n.complete&&a()});n.addEventListener("error",a);n.addEventListener("load",a)})))}k=e.getBoundingClientRect();n.attr("width",k.width);n.attr("height",k.height)}if(l){c.attr("transform","translate("+-k.width/2+", "+-k.height/2+")")}else{c.attr("transform","translate(0, "+-k.height/2+")")}i.centerLabel&&c.attr("transform","translate("+-k.width/2+", "+-k.height/2+")");c.insert("rect",":first-child");return{shapeSvg:d,bbox:k,halfPadding:m,label:c}},"labelHelper");var et=t((e,t)=>{const n=t.node().getBBox();e.width=n.width;e.height=n.height},"updateNodeBounds");function tt(e,t,n,i){return e.insert("polygon",":first-child").attr("points",i.map(function(e){return e.x+","+e.y}).join(" ")).attr("class","label-container").attr("transform","translate("+-t/2+","+n/2+")")}t(tt,"insertPolygonShape");var nt=t(async(e,t)=>{const i=t.useHtmlLabels||n().flowchart.htmlLabels;i||(t.centerLabel=!0);const{shapeSvg:o,bbox:r,halfPadding:s}=await Qe(e,t,"node "+t.classes,!0);a.info("Classes = ",t.classes);const l=o.insert("rect",":first-child");l.attr("rx",t.rx).attr("ry",t.ry).attr("x",-r.width/2-s).attr("y",-r.height/2-s).attr("width",r.width+t.padding).attr("height",r.height+t.padding);et(t,l);t.intersect=function(e){return Ue.rect(t,e)};return o},"note");var it=t(e=>{if(e){return" "+e}return""},"formatClass");var at=t((e,t)=>`${t?t:"node default"}${it(e.classes)} ${it(e.class)}`,"getClassesFromNode");var ot=t(async(e,t)=>{const{shapeSvg:n,bbox:i}=await Qe(e,t,at(t,void 0),!0);const o=i.width+t.padding;const r=i.height+t.padding;const s=o+r;const l=[{x:s/2,y:0},{x:s,y:-s/2},{x:s/2,y:-s},{x:0,y:-s/2}];a.info("Question main (Circle)");const d=tt(n,s,s,l);d.attr("style",t.style);et(t,d);t.intersect=function(e){a.warn("Intersect called");return Ue.polygon(t,l,e)};return n},"question");var rt=t((e,t)=>{const n=e.insert("g").attr("class","node default").attr("id",t.domId||t.id);const i=28;const a=[{x:0,y:i/2},{x:i/2,y:0},{x:0,y:-i/2},{x:-i/2,y:0}];const o=n.insert("polygon",":first-child").attr("points",a.map(function(e){return e.x+","+e.y}).join(" "));o.attr("class","state-start").attr("r",7).attr("width",28).attr("height",28);t.width=28;t.height=28;t.intersect=function(e){return Ue.circle(t,14,e)};return n},"choice");var st=t(async(e,t)=>{const{shapeSvg:n,bbox:i}=await Qe(e,t,at(t,void 0),!0);const a=4;const o=i.height+t.padding;const r=o/a;const s=i.width+2*r+t.padding;const l=[{x:r,y:0},{x:s-r,y:0},{x:s,y:-o/2},{x:s-r,y:-o},{x:r,y:-o},{x:0,y:-o/2}];const d=tt(n,s,o,l);d.attr("style",t.style);et(t,d);t.intersect=function(e){return Ue.polygon(t,l,e)};return n},"hexagon");var lt=t(async(e,t)=>{const{shapeSvg:n,bbox:i}=await Qe(e,t,void 0,!0);const a=2;const o=i.height+2*t.padding;const r=o/a;const s=i.width+2*r+t.padding;const l=We(t.directions,i,t);const d=tt(n,s,o,l);d.attr("style",t.style);et(t,d);t.intersect=function(e){return Ue.polygon(t,l,e)};return n},"block_arrow");var dt=t(async(e,t)=>{const{shapeSvg:n,bbox:i}=await Qe(e,t,at(t,void 0),!0);const a=i.width+t.padding;const o=i.height+t.padding;const r=[{x:-o/2,y:0},{x:a,y:0},{x:a,y:-o},{x:-o/2,y:-o},{x:0,y:-o/2}];const s=tt(n,a,o,r);s.attr("style",t.style);t.width=a+o;t.height=o;t.intersect=function(e){return Ue.polygon(t,r,e)};return n},"rect_left_inv_arrow");var ct=t(async(e,t)=>{const{shapeSvg:n,bbox:i}=await Qe(e,t,at(t),!0);const a=i.width+t.padding;const o=i.height+t.padding;const r=[{x:-2*o/6,y:0},{x:a-o/6,y:0},{x:a+2*o/6,y:-o},{x:o/6,y:-o}];const s=tt(n,a,o,r);s.attr("style",t.style);et(t,s);t.intersect=function(e){return Ue.polygon(t,r,e)};return n},"lean_right");var ht=t(async(e,t)=>{const{shapeSvg:n,bbox:i}=await Qe(e,t,at(t,void 0),!0);const a=i.width+t.padding;const o=i.height+t.padding;const r=[{x:2*o/6,y:0},{x:a+o/6,y:0},{x:a-2*o/6,y:-o},{x:-o/6,y:-o}];const s=tt(n,a,o,r);s.attr("style",t.style);et(t,s);t.intersect=function(e){return Ue.polygon(t,r,e)};return n},"lean_left");var _t=t(async(e,t)=>{const{shapeSvg:n,bbox:i}=await Qe(e,t,at(t,void 0),!0);const a=i.width+t.padding;const o=i.height+t.padding;const r=[{x:-2*o/6,y:0},{x:a+2*o/6,y:0},{x:a-o/6,y:-o},{x:o/6,y:-o}];const s=tt(n,a,o,r);s.attr("style",t.style);et(t,s);t.intersect=function(e){return Ue.polygon(t,r,e)};return n},"trapezoid");var gt=t(async(e,t)=>{const{shapeSvg:n,bbox:i}=await Qe(e,t,at(t,void 0),!0);const a=i.width+t.padding;const o=i.height+t.padding;const r=[{x:o/6,y:0},{x:a-o/6,y:0},{x:a+2*o/6,y:-o},{x:-2*o/6,y:-o}];const s=tt(n,a,o,r);s.attr("style",t.style);et(t,s);t.intersect=function(e){return Ue.polygon(t,r,e)};return n},"inv_trapezoid");var pt=t(async(e,t)=>{const{shapeSvg:n,bbox:i}=await Qe(e,t,at(t,void 0),!0);const a=i.width+t.padding;const o=i.height+t.padding;const r=[{x:0,y:0},{x:a+o/2,y:0},{x:a,y:-o/2},{x:a+o/2,y:-o},{x:0,y:-o}];const s=tt(n,a,o,r);s.attr("style",t.style);et(t,s);t.intersect=function(e){return Ue.polygon(t,r,e)};return n},"rect_right_inv_arrow");var bt=t(async(e,t)=>{const{shapeSvg:n,bbox:i}=await Qe(e,t,at(t,void 0),!0);const a=i.width+t.padding;const o=a/2;const r=o/(2.5+a/50);const s=i.height+r+t.padding;const l="M 0,"+r+" a "+o+","+r+" 0,0,0 "+a+" 0 a "+o+","+r+" 0,0,0 "+-a+" 0 l 0,"+s+" a "+o+","+r+" 0,0,0 "+a+" 0 l 0,"+-s;const d=n.attr("label-offset-y",r).insert("path",":first-child").attr("style",t.style).attr("d",l).attr("transform","translate("+-a/2+","+-(s/2+r)+")");et(t,d);t.intersect=function(e){const n=Ue.rect(t,e);const i=n.x-t.x;if(o!=0&&(Math.abs(i)<t.width/2||Math.abs(i)==t.width/2&&Math.abs(n.y-t.y)>t.height/2-r)){let a=r*r*(1-i*i/(o*o));a!=0&&(a=Math.sqrt(a));a=r-a;e.y-t.y>0&&(a=-a);n.y+=a}return n};return n},"cylinder");var ut=t(async(e,t)=>{const{shapeSvg:n,bbox:i,halfPadding:o}=await Qe(e,t,"node "+t.classes+" "+t.class,!0);const r=n.insert("rect",":first-child");const s=t.positioned?t.width:i.width+t.padding;const l=t.positioned?t.height:i.height+t.padding;const d=t.positioned?-s/2:-i.width/2-o;const c=t.positioned?-l/2:-i.height/2-o;r.attr("class","basic label-container").attr("style",t.style).attr("rx",t.rx).attr("ry",t.ry).attr("x",d).attr("y",c).attr("width",s).attr("height",l);if(t.props){let e=new Set(Object.keys(t.props));if(t.props.borders){kt(r,t.props.borders,s,l);e.delete("borders")}e.forEach(e=>{a.warn(`Unknown node property ${e}`)})}et(t,r);t.intersect=function(e){return Ue.rect(t,e)};return n},"rect");var yt=t(async(e,t)=>{const{shapeSvg:n,bbox:i,halfPadding:o}=await Qe(e,t,"node "+t.classes,!0);const r=n.insert("rect",":first-child");const s=t.positioned?t.width:i.width+t.padding;const l=t.positioned?t.height:i.height+t.padding;const d=t.positioned?-s/2:-i.width/2-o;const c=t.positioned?-l/2:-i.height/2-o;r.attr("class","basic cluster composite label-container").attr("style",t.style).attr("rx",t.rx).attr("ry",t.ry).attr("x",d).attr("y",c).attr("width",s).attr("height",l);if(t.props){let e=new Set(Object.keys(t.props));if(t.props.borders){kt(r,t.props.borders,s,l);e.delete("borders")}e.forEach(e=>{a.warn(`Unknown node property ${e}`)})}et(t,r);t.intersect=function(e){return Ue.rect(t,e)};return n},"composite");var xt=t(async(e,t)=>{const{shapeSvg:n}=await Qe(e,t,"label",!0);a.trace("Classes = ",t.class);const i=n.insert("rect",":first-child");const o=0;const r=0;i.attr("width",o).attr("height",r);n.attr("class","label edgeLabel");if(t.props){let e=new Set(Object.keys(t.props));if(t.props.borders){kt(i,t.props.borders,o,r);e.delete("borders")}e.forEach(e=>{a.warn(`Unknown node property ${e}`)})}et(t,i);t.intersect=function(e){return Ue.rect(t,e)};return n},"labelRect");function kt(e,n,i,o){const r=[];const s=t(e=>{r.push(e,0)},"addBorder");const l=t(e=>{r.push(0,e)},"skipBorder");if(n.includes("t")){a.debug("add top border");s(i)}else{l(i)}if(n.includes("r")){
a.debug("add right border");s(o)}else{l(o)}if(n.includes("b")){a.debug("add bottom border");s(i)}else{l(i)}if(n.includes("l")){a.debug("add left border");s(o)}else{l(o)}e.attr("stroke-dasharray",r.join(" "))}t(kt,"applyNodePropertyBorders");var mt=t(async(e,t)=>{let i;if(!t.classes){i="node default"}else{i="node "+t.classes}const o=e.insert("g").attr("class",i).attr("id",t.domId||t.id);const r=o.insert("rect",":first-child");const s=o.insert("line");const l=o.insert("g").attr("class","label");const d=t.labelText.flat?t.labelText.flat():t.labelText;let c="";if(typeof d==="object"){c=d[0]}else{c=d}a.info("Label text abc79",c,d,typeof d==="object");const _=l.node().appendChild(await Ee(c,t.labelStyle,!0,!0));let p={width:0,height:0};if(g(n().flowchart.htmlLabels)){let e=_.children[0],t=h(_);p=e.getBoundingClientRect();t.attr("width",p.width);t.attr("height",p.height)}a.info("Text 2",d);const b=d.slice(1,d.length);let u=_.getBBox();const y=l.node().appendChild(await Ee(b.join?b.join("<br/>"):b,t.labelStyle,!0,!0));if(g(n().flowchart.htmlLabels)){let e=y.children[0],t=h(y);p=e.getBoundingClientRect();t.attr("width",p.width);t.attr("height",p.height)}const x=t.padding/2;h(y).attr("transform","translate( "+(p.width>u.width?0:(u.width-p.width)/2)+", "+(u.height+x+5)+")");h(_).attr("transform","translate( "+(p.width<u.width?0:-(u.width-p.width)/2)+", 0)");p=l.node().getBBox();l.attr("transform","translate("+-p.width/2+", "+(-p.height/2-x+3)+")");r.attr("class","outer title-state").attr("x",-p.width/2-x).attr("y",-p.height/2-x).attr("width",p.width+t.padding).attr("height",p.height+t.padding);s.attr("class","divider").attr("x1",-p.width/2-x).attr("x2",p.width/2+x).attr("y1",-p.height/2-x+u.height+x).attr("y2",-p.height/2-x+u.height+x);et(t,r);t.intersect=function(e){return Ue.rect(t,e)};return o},"rectWithTitle");var ft=t(async(e,t)=>{const{shapeSvg:n,bbox:i}=await Qe(e,t,at(t,void 0),!0);const a=i.height+t.padding;const o=i.width+a/4+t.padding;const r=n.insert("rect",":first-child").attr("style",t.style).attr("rx",a/2).attr("ry",a/2).attr("x",-o/2).attr("y",-a/2).attr("width",o).attr("height",a);et(t,r);t.intersect=function(e){return Ue.rect(t,e)};return n},"stadium");var vt=t(async(e,t)=>{const{shapeSvg:n,bbox:i,halfPadding:o}=await Qe(e,t,at(t,void 0),!0);const r=n.insert("circle",":first-child");r.attr("style",t.style).attr("rx",t.rx).attr("ry",t.ry).attr("r",i.width/2+o).attr("width",i.width+t.padding).attr("height",i.height+t.padding);a.info("Circle main");et(t,r);t.intersect=function(e){a.info("Circle intersect",t,i.width/2+o,e);return Ue.circle(t,i.width/2+o,e)};return n},"circle");var wt=t(async(e,t)=>{const{shapeSvg:n,bbox:i,halfPadding:o}=await Qe(e,t,at(t,void 0),!0);const r=5;const s=n.insert("g",":first-child");const l=s.insert("circle");const d=s.insert("circle");s.attr("class",t.class);l.attr("style",t.style).attr("rx",t.rx).attr("ry",t.ry).attr("r",i.width/2+o+r).attr("width",i.width+t.padding+r*2).attr("height",i.height+t.padding+r*2);d.attr("style",t.style).attr("rx",t.rx).attr("ry",t.ry).attr("r",i.width/2+o).attr("width",i.width+t.padding).attr("height",i.height+t.padding);a.info("DoubleCircle main");et(t,l);t.intersect=function(e){a.info("DoubleCircle intersect",t,i.width/2+o+r,e);return Ue.circle(t,i.width/2+o+r,e)};return n},"doublecircle");var St=t(async(e,t)=>{const{shapeSvg:n,bbox:i}=await Qe(e,t,at(t,void 0),!0);const a=i.width+t.padding;const o=i.height+t.padding;const r=[{x:0,y:0},{x:a,y:0},{x:a,y:-o},{x:0,y:-o},{x:0,y:0},{x:-8,y:0},{x:a+8,y:0},{x:a+8,y:-o},{x:-8,y:-o},{x:-8,y:0}];const s=tt(n,a,o,r);s.attr("style",t.style);et(t,s);t.intersect=function(e){return Ue.polygon(t,r,e)};return n},"subroutine");var Bt=t((e,t)=>{const n=e.insert("g").attr("class","node default").attr("id",t.domId||t.id);const i=n.insert("circle",":first-child");i.attr("class","state-start").attr("r",7).attr("width",14).attr("height",14);et(t,i);t.intersect=function(e){return Ue.circle(t,7,e)};return n},"start");var Lt=t((e,t,n)=>{const i=e.insert("g").attr("class","node default").attr("id",t.domId||t.id);let a=70;let o=10;if(n==="LR"){a=10;o=70}const r=i.append("rect").attr("x",-1*a/2).attr("y",-1*o/2).attr("width",a).attr("height",o).attr("class","fork-join");et(t,r);t.height=t.height+t.padding/2;t.width=t.width+t.padding/2;t.intersect=function(e){return Ue.rect(t,e)};return i},"forkJoin");var $t=t((e,t)=>{const n=e.insert("g").attr("class","node default").attr("id",t.domId||t.id);const i=n.insert("circle",":first-child");const a=n.insert("circle",":first-child");a.attr("class","state-start").attr("r",7).attr("width",14).attr("height",14);i.attr("class","state-end").attr("r",5).attr("width",10).attr("height",10);et(t,a);t.intersect=function(e){return Ue.circle(t,7,e)};return n},"end");var At=t(async(e,t)=>{var i;const a=t.padding/2;const o=4;const r=8;let s;if(!t.classes){s="node default"}else{s="node "+t.classes}const l=e.insert("g").attr("class",s).attr("id",t.domId||t.id);const d=l.insert("rect",":first-child");const c=l.insert("line");const _=l.insert("line");let p=0;let b=o;const u=l.insert("g").attr("class","label");let y=0;const x=(i=t.classData.annotations)===null||i===void 0?void 0:i[0];const k=t.classData.annotations[0]?"«"+t.classData.annotations[0]+"»":"";const m=u.node().appendChild(await Ee(k,t.labelStyle,!0,!0));let f=m.getBBox();if(g(n().flowchart.htmlLabels)){let e=m.children[0],t=h(m);f=e.getBoundingClientRect();t.attr("width",f.width);t.attr("height",f.height)}if(t.classData.annotations[0]){b+=f.height+o;p+=f.width}let v=t.classData.label;if(t.classData.type!==void 0&&t.classData.type!==""){if(n().flowchart.htmlLabels){v+="&lt;"+t.classData.type+"&gt;"}else{v+="<"+t.classData.type+">"}}const w=u.node().appendChild(await Ee(v,t.labelStyle,!0,!0));h(w).attr("class","classTitle");let S=w.getBBox();if(g(n().flowchart.htmlLabels)){let e=w.children[0],t=h(w);S=e.getBoundingClientRect();t.attr("width",S.width);t.attr("height",S.height)}b+=S.height+o;S.width>p&&(p=S.width);const B=[];t.classData.members.forEach(async e=>{const i=e.getDisplayDetails();let a=i.displayText;n().flowchart.htmlLabels&&(a=a.replace(/</g,"&lt;").replace(/>/g,"&gt;"));const r=u.node().appendChild(await Ee(a,i.cssStyle?i.cssStyle:t.labelStyle,!0,!0));let s=r.getBBox();if(g(n().flowchart.htmlLabels)){let e=r.children[0],t=h(r);s=e.getBoundingClientRect();t.attr("width",s.width);t.attr("height",s.height)}s.width>p&&(p=s.width);b+=s.height+o;B.push(r)});b+=r;const L=[];t.classData.methods.forEach(async e=>{const i=e.getDisplayDetails();let a=i.displayText;n().flowchart.htmlLabels&&(a=a.replace(/</g,"&lt;").replace(/>/g,"&gt;"));const r=u.node().appendChild(await Ee(a,i.cssStyle?i.cssStyle:t.labelStyle,!0,!0));let s=r.getBBox();if(g(n().flowchart.htmlLabels)){let e=r.children[0],t=h(r);s=e.getBoundingClientRect();t.attr("width",s.width);t.attr("height",s.height)}s.width>p&&(p=s.width);b+=s.height+o;L.push(r)});b+=r;if(x){let e=(p-f.width)/2;h(m).attr("transform","translate( "+(-1*p/2+e)+", "+-1*b/2+")");y=f.height+o}let $=(p-S.width)/2;h(w).attr("transform","translate( "+(-1*p/2+$)+", "+(-1*b/2+y)+")");y+=S.height+o;c.attr("class","divider").attr("x1",-p/2-a).attr("x2",p/2+a).attr("y1",-b/2-a+r+y).attr("y2",-b/2-a+r+y);y+=r;B.forEach(e=>{var t;h(e).attr("transform","translate( "+-p/2+", "+(-1*b/2+y+r/2)+")");const n=e===null||e===void 0?void 0:e.getBBox();y+=((t=n===null||n===void 0?void 0:n.height)!==null&&t!==void 0?t:0)+o});y+=r;_.attr("class","divider").attr("x1",-p/2-a).attr("x2",p/2+a).attr("y1",-b/2-a+r+y).attr("y2",-b/2-a+r+y);y+=r;L.forEach(e=>{var t;h(e).attr("transform","translate( "+-p/2+", "+(-1*b/2+y)+")");const n=e===null||e===void 0?void 0:e.getBBox();y+=((t=n===null||n===void 0?void 0:n.height)!==null&&t!==void 0?t:0)+o});d.attr("style",t.style).attr("class","outer title-state").attr("x",-p/2-a).attr("y",-(b/2)-a).attr("width",p+t.padding).attr("height",b+t.padding);et(t,d);t.intersect=function(e){return Ue.rect(t,e)};return l},"class_box");var Rt={rhombus:ot,composite:yt,question:ot,rect:ut,labelRect:xt,rectWithTitle:mt,choice:rt,circle:vt,doublecircle:wt,stadium:ft,hexagon:st,block_arrow:lt,rect_left_inv_arrow:dt,lean_right:ct,lean_left:ht,trapezoid:_t,inv_trapezoid:gt,rect_right_inv_arrow:pt,cylinder:bt,start:Bt,end:$t,note:nt,subroutine:St,fork:Lt,join:Lt,class_box:At};var Et={};var Ht=t(async(e,t,i)=>{let a;let o;if(t.link){let r;if(n().securityLevel==="sandbox"){r="_top"}else t.linkTarget&&(r=t.linkTarget||"_blank");a=e.insert("svg:a").attr("xlink:href",t.link).attr("target",r);o=await Rt[t.shape](a,t,i)}else{o=await Rt[t.shape](e,t,i);a=o}t.tooltip&&o.attr("title",t.tooltip);t.class&&o.attr("class","node default "+t.class);Et[t.id]=a;t.haveCallback&&Et[t.id].attr("class",Et[t.id].attr("class")+" clickable");return a},"insertNode");var Dt=t(e=>{const t=Et[e.id];a.trace("Transforming node",e.diff,e,"translate("+(e.x-e.width/2-5)+", "+e.width/2+")");const n=8;const i=e.diff||0;if(e.clusterNode){t.attr("transform","translate("+(e.x+i-e.width/2)+", "+(e.y-e.height/2-n)+")")}else{t.attr("transform","translate("+e.x+", "+e.y+")")}return i},"positionNode");function Ft(e,t,n=!1){var i,a,o,r,l,d,c;const h=e;let _="default";(((i=e===null||e===void 0?void 0:e.classes)===null||i===void 0?void 0:i.length)||0)>0&&(_=((a=e===null||e===void 0?void 0:e.classes)!==null&&a!==void 0?a:[]).join(" "));_=_+" flowchart-label";let g=0;let p="";let b;switch(h.type){case"round":g=5;p="rect";break;case"composite":g=0;p="composite";b=0;break;case"square":p="rect";break;case"diamond":p="question";break;case"hexagon":p="hexagon";break;case"block_arrow":p="block_arrow";break;case"odd":p="rect_left_inv_arrow";break;case"lean_right":p="lean_right";break;case"lean_left":p="lean_left";break;case"trapezoid":p="trapezoid";break;case"inv_trapezoid":p="inv_trapezoid";break;case"rect_left_inv_arrow":p="rect_left_inv_arrow";break;case"circle":p="circle";break;case"ellipse":p="ellipse";break;case"stadium":p="stadium";break;case"subroutine":p="subroutine";break;case"cylinder":p="cylinder";break;case"group":p="rect";break;case"doublecircle":p="doublecircle";break;default:p="rect"}const u=w((o=e===null||e===void 0?void 0:e.styles)!==null&&o!==void 0?o:[]);const y=e.label;const x=(r=e.size)!==null&&r!==void 0?r:{width:0,height:0,x:0,y:0};const k={labelStyle:u.labelStyle,shape:p,labelText:y,rx:g,ry:g,class:_,style:u.style,id:e.id,directions:e.directions,width:x.width,height:x.height,x:x.x,y:x.y,positioned:n,intersect:void 0,type:e.type,padding:(c=b!==null&&b!==void 0?b:(d=(l=s())===null||l===void 0?void 0:l.block)===null||d===void 0?void 0:d.padding)!==null&&c!==void 0?c:0};return k}t(Ft,"getNodeFromBlock");async function Jt(e,t,n){const i=Ft(t,n,!1);if(i.type==="group"){return}const a=s();const o=await Ht(e,i,{config:a});const r=o.node().getBBox();const l=n.getBlock(i.id);l.size={width:r.width,height:r.height,x:0,y:0,node:o};n.setBlock(l);o.remove()}t(Jt,"calculateBlockSize");async function Ct(e,t,n){const i=Ft(t,n,!0);const a=n.getBlock(i.id);if(a.type!=="space"){let n=s();await Ht(e,i,{config:n});t.intersect=i===null||i===void 0?void 0:i.intersect;Dt(i)}}t(Ct,"insertBlockPositioned");async function Tt(e,t,n,i){for(const a of t){await i(e,a,n);a.children&&await Tt(e,a.children,n,i)}}t(Tt,"performOperations");async function Pt(e,t,n){await Tt(e,t,n,Jt)}t(Pt,"calculateBlockSizes");async function Nt(e,t,n){await Tt(e,t,n,Ct)}t(Nt,"insertBlocks");async function Gt(e,t,n,i,a){const o=new S({multigraph:!0,compound:!0});o.setGraph({rankdir:"TB",nodesep:10,ranksep:10,marginx:8,marginy:8});for(const e of n){e.size&&o.setNode(e.id,{width:e.size.width,height:e.size.height,intersect:e.intersect})}for(const n of t){if(n.start&&n.end){let t=i.getBlock(n.start),r=i.getBlock(n.end);if((t===null||t===void 0?void 0:t.size)&&(r===null||r===void 0?void 0:r.size)){let i=t.size,s=r.size,l=[{x:i.x,y:i.y},{x:i.x+(s.x-i.x)/2,y:i.y+(s.y-i.y)/2},{x:s.x,y:s.y}];ze(e,{v:n.start,w:n.end,name:n.id},{...n,arrowTypeEnd:n.arrowTypeEnd,arrowTypeStart:n.arrowTypeStart,points:l,classes:"edge-thickness-normal edge-pattern-solid flowchart-link LS-a1 LE-b1"},void 0,"block",o,a);if(n.label){await Te(e,{...n,label:n.label,labelStyle:"stroke: #333; stroke-width: 1.5px;fill:none;",arrowTypeEnd:n.arrowTypeEnd,arrowTypeStart:n.arrowTypeStart,points:l,classes:"edge-thickness-normal edge-pattern-solid flowchart-link LS-a1 LE-b1"});Ne({...n,x:l[1].x,y:l[1].y},{originalPath:l})}}}}}t(Gt,"insertEdges");var It=t(function(e,t){return t.db.getClasses()},"getClasses");var Ot=t(async function(e,t,n,i){const{securityLevel:o,block:r}=s();const l=i.db;let d;o==="sandbox"&&(d=h("#i"+t));const c=o==="sandbox"?h(d.nodes()[0].contentDocument.body):h("body");const _=o==="sandbox"?c.select(`[id="${t}"]`):h(`[id="${t}"]`);const g=["point","circle","cross"];ce(_,g,i.type,t);const p=l.getBlocks();const b=l.getBlocksFlat();const u=l.getEdges();const y=_.insert("g").attr("class","block");await Pt(y,p,l);const x=$e(l);await Nt(y,p,l);await Gt(y,u,b,l,t);if(x){let e=x,t=Math.max(1,Math.round(.125*(e.width/e.height))),n=e.height+t+10,i=e.width+10,{useMaxWidth:o}=r;B(_,n,i,!!o);a.debug("Here Bounds",x,e);_.attr("viewBox",`${e.x-5} ${e.y-5} ${e.width+10} ${e.height+10}`)}},"draw");var zt={draw:Ot,getClasses:It};var Yt={parser:R,db:se,renderer:zt,styles:de};var Wt={diagram:Yt};__bbb.U=Wt}).call(this)