(function(t){"use strict";var e=__bbb.Mb;var n=__bbb.Ac;var a=__bbb.ac;var s=__bbb.tc;var r=__bbb.uc;var i=__bbb.hc;var o=__bbb.ic;var c=__bbb.kc;var l=__bbb.jc;var _=__bbb.Ic;var h=__bbb.lc;var u=__bbb.Ld;var d=__bbb.je;var y=__bbb.mc;var p=__bbb.Xd;var k=__bbb.dc;var f=__bbb.sc;var m=function(){var t=e(function(t,e,n,a){for(n=n||{},a=t.length;a--;n[t[a]]=e);return n},"o"),n=[6,8,10,11,12,14,16,17,18],a=[1,9],s=[1,10],r=[1,11],i=[1,12],o=[1,13],c=[1,14];var l={trace:e(function t(){},"trace"),yy:{},symbols_:{error:2,start:3,journey:4,document:5,EOF:6,line:7,SPACE:8,statement:9,NEWLINE:10,title:11,acc_title:12,acc_title_value:13,acc_descr:14,acc_descr_value:15,acc_descr_multiline_value:16,section:17,taskName:18,taskData:19,$accept:0,$end:1},terminals_:{2:"error",4:"journey",6:"EOF",8:"SPACE",10:"NEWLINE",11:"title",12:"acc_title",13:"acc_title_value",14:"acc_descr",15:"acc_descr_value",16:"acc_descr_multiline_value",17:"section",18:"taskName",19:"taskData"},productions_:[0,[3,3],[5,0],[5,2],[7,2],[7,1],[7,1],[7,1],[9,1],[9,2],[9,2],[9,1],[9,1],[9,2]],performAction:e(function t(e,n,a,s,r,i,o){var c=i.length-1;switch(r){case 1:return i[c-1];break;case 2:this.$=[];break;case 3:i[c-1].push(i[c]);this.$=i[c-1];break;case 4:case 5:this.$=i[c];break;case 6:case 7:this.$=[];break;case 8:s.setDiagramTitle(i[c].substr(6));this.$=i[c].substr(6);break;case 9:this.$=i[c].trim();s.setAccTitle(this.$);break;case 10:case 11:this.$=i[c].trim();s.setAccDescription(this.$);break;case 12:s.addSection(i[c].substr(8));this.$=i[c].substr(8);break;case 13:s.addTask(i[c-1],i[c]);this.$="task";break}},"anonymous"),table:[{3:1,4:[1,2]},{1:[3]},t(n,[2,2],{5:3}),{6:[1,4],7:5,8:[1,6],9:7,10:[1,8],11:a,12:s,14:r,16:i,17:o,18:c},t(n,[2,7],{1:[2,1]}),t(n,[2,3]),{9:15,11:a,12:s,14:r,16:i,17:o,18:c},t(n,[2,5]),t(n,[2,6]),t(n,[2,8]),{13:[1,16]},{15:[1,17]},t(n,[2,11]),t(n,[2,12]),{19:[1,18]},t(n,[2,4]),t(n,[2,9]),t(n,[2,10]),t(n,[2,13])],defaultActions:{},parseError:e(function t(e,n){if(n.recoverable){this.trace(e)}else{var a=new Error(e);a.hash=n;throw a}},"parseError"),parse:e(function t(n){var a=this,s=[0],r=[],i=[null],o=[],c=this.table,l="",_=0,h=0,u=0,d=2,y=1;var p=o.slice.call(arguments,1);var k=Object.create(this.lexer);var f={yy:{}};for(var m in this.yy){Object.prototype.hasOwnProperty.call(this.yy,m)&&(f.yy[m]=this.yy[m])}k.setInput(n,f.yy);f.yy.lexer=k;f.yy.parser=this;typeof k.yylloc=="undefined"&&(k.yylloc={});var g=k.yylloc;o.push(g);var x=k.options&&k.options.ranges;if(typeof f.yy.parseError==="function"){this.parseError=f.yy.parseError}else{this.parseError=Object.getPrototypeOf(this).parseError}function b(t){s.length=s.length-2*t;i.length=i.length-t;o.length=o.length-t}e(b,"popStack");function v(){var t;t=r.pop()||k.lex()||y;if(typeof t!=="number"){if(t instanceof Array){r=t;t=r.pop()}t=a.symbols_[t]||t}return t}e(v,"lex");var A,w,$,T,B,F={},S,R,D,J;while(!0){$=s[s.length-1];if(this.defaultActions[$]){T=this.defaultActions[$]}else{(A===null||typeof A=="undefined")&&(A=v());T=c[$]&&c[$][A]}if(typeof T==="undefined"||!T.length||!T[0]){var H="";J=[];for(S in c[$]){this.terminals_[S]&&S>d&&J.push("'"+this.terminals_[S]+"'")}if(k.showPosition){H="Parse error on line "+(_+1)+":\n"+k.showPosition()+"\nExpecting "+J.join(", ")+", got '"+(this.terminals_[A]||A)+"'"}else{H="Parse error on line "+(_+1)+": Unexpected "+(A==y?"end of input":"'"+(this.terminals_[A]||A)+"'")}this.parseError(H,{text:k.match,token:this.terminals_[A]||A,line:k.yylineno,loc:g,expected:J})}if(T[0]instanceof Array&&T.length>1){throw new Error("Parse Error: multiple actions possible at state: "+$+", token: "+A)}switch(T[0]){case 1:s.push(A);i.push(k.yytext);o.push(k.yylloc);s.push(T[1]);A=null;if(!w){h=k.yyleng;l=k.yytext;_=k.yylineno;g=k.yylloc;u>0&&u--}else{A=w;w=null}break;case 2:R=this.productions_[T[1]][1];F.$=i[i.length-R];F._$={first_line:o[o.length-(R||1)].first_line,last_line:o[o.length-1].last_line,first_column:o[o.length-(R||1)].first_column,last_column:o[o.length-1].last_column};x&&(F._$.range=[o[o.length-(R||1)].range[0],o[o.length-1].range[1]]);B=this.performAction.apply(F,[l,h,_,f.yy,T[1],i,o].concat(p));if(typeof B!=="undefined"){return B}if(R){s=s.slice(0,-1*R*2);i=i.slice(0,-1*R);o=o.slice(0,-1*R)}s.push(this.productions_[T[1]][0]);i.push(F.$);o.push(F._$);D=c[s[s.length-2]][s[s.length-1]];s.push(D);break;case 3:return!0}}return!0},"parse")};var _=function(){var t={EOF:1,parseError:e(function t(e,n){if(this.yy.parser){this.yy.parser.parseError(e,n)}else{throw new Error(e)}},"parseError"),setInput:e(function(t,e){this.yy=e||this.yy||{};this._input=t;this._more=this._backtrack=this.done=!1;this.yylineno=this.yyleng=0;this.yytext=this.matched=this.match="";this.conditionStack=["INITIAL"];this.yylloc={first_line:1,first_column:0,last_line:1,last_column:0};this.options.ranges&&(this.yylloc.range=[0,0]);this.offset=0;return this},"setInput"),input:e(function(){var t=this._input[0];this.yytext+=t;this.yyleng++;this.offset++;this.match+=t;this.matched+=t;var e=t.match(/(?:\r\n?|\n).*/g);if(e){this.yylineno++;this.yylloc.last_line++}else{this.yylloc.last_column++}this.options.ranges&&this.yylloc.range[1]++;this._input=this._input.slice(1);return t},"input"),unput:e(function(t){var e=t.length;var n=t.split(/(?:\r\n?|\n)/g);this._input=t+this._input;this.yytext=this.yytext.substr(0,this.yytext.length-e);this.offset-=e;var a=this.match.split(/(?:\r\n?|\n)/g);this.match=this.match.substr(0,this.match.length-1);this.matched=this.matched.substr(0,this.matched.length-1);n.length-1&&(this.yylineno-=n.length-1);var s=this.yylloc.range;this.yylloc={first_line:this.yylloc.first_line,last_line:this.yylineno+1,first_column:this.yylloc.first_column,last_column:n?(n.length===a.length?this.yylloc.first_column:0)+a[a.length-n.length].length-n[0].length:this.yylloc.first_column-e};this.options.ranges&&(this.yylloc.range=[s[0],s[0]+this.yyleng-e]);this.yyleng=this.yytext.length;return this},"unput"),more:e(function(){this._more=!0;return this},"more"),reject:e(function(){if(this.options.backtrack_lexer){this._backtrack=!0}else{return this.parseError("Lexical error on line "+(this.yylineno+1)+". You can only invoke reject() in the lexer when the lexer is of the backtracking persuasion (options.backtrack_lexer = true).\n"+this.showPosition(),{text:"",token:null,line:this.yylineno})}return this},"reject"),less:e(function(t){this.unput(this.match.slice(t))},"less"),pastInput:e(function(){var t=this.matched.substr(0,this.matched.length-this.match.length);return(t.length>20?"...":"")+t.substr(-20).replace(/\n/g,"")},"pastInput"),upcomingInput:e(function(){var t=this.match;t.length<20&&(t+=this._input.substr(0,20-t.length));return(t.substr(0,20)+(t.length>20?"...":"")).replace(/\n/g,"")},"upcomingInput"),showPosition:e(function(){var t=this.pastInput();var e=new Array(t.length+1).join("-");return t+this.upcomingInput()+"\n"+e+"^"},"showPosition"),test_match:e(function(t,e){var n,a,s;if(this.options.backtrack_lexer){s={yylineno:this.yylineno,yylloc:{first_line:this.yylloc.first_line,last_line:this.last_line,first_column:this.yylloc.first_column,last_column:this.yylloc.last_column},yytext:this.yytext,match:this.match,matches:this.matches,matched:this.matched,yyleng:this.yyleng,offset:this.offset,_more:this._more,_input:this._input,yy:this.yy,conditionStack:this.conditionStack.slice(0),done:this.done};this.options.ranges&&(s.yylloc.range=this.yylloc.range.slice(0))}a=t[0].match(/(?:\r\n?|\n).*/g);a&&(this.yylineno+=a.length);this.yylloc={first_line:this.yylloc.last_line,last_line:this.yylineno+1,first_column:this.yylloc.last_column,last_column:a?a[a.length-1].length-a[a.length-1].match(/\r?\n?/)[0].length:this.yylloc.last_column+t[0].length};this.yytext+=t[0];this.match+=t[0];this.matches=t;this.yyleng=this.yytext.length;this.options.ranges&&(this.yylloc.range=[this.offset,this.offset+=this.yyleng]);this._more=!1;this._backtrack=!1;this._input=this._input.slice(t[0].length);this.matched+=t[0];n=this.performAction.call(this,this.yy,this,e,this.conditionStack[this.conditionStack.length-1]);this.done&&this._input&&(this.done=!1);if(n){return n}else if(this._backtrack){for(var r in s){this[r]=s[r]}return!1}return!1},"test_match"),next:e(function(){if(this.done){return this.EOF}this._input||(this.done=!0);var t,e,n,a;if(!this._more){this.yytext="";this.match=""}var s=this._currentRules();for(var r=0;r<s.length;r++){n=this._input.match(this.rules[s[r]]);if(n&&(!e||n[0].length>e[0].length)){e=n;a=r;if(this.options.backtrack_lexer){t=this.test_match(n,s[r]);if(t!==!1){return t}else if(this._backtrack){e=!1;continue}else{return!1}}else if(!this.options.flex){break}}}if(e){t=this.test_match(e,s[a]);if(t!==!1){return t}return!1}if(this._input===""){return this.EOF}else{return this.parseError("Lexical error on line "+(this.yylineno+1)+". Unrecognized text.\n"+this.showPosition(),{text:"",token:null,line:this.yylineno})}},"next"),lex:e(function t(){var e=this.next();if(e){return e}else{return this.lex()}},"lex"),begin:e(function t(e){this.conditionStack.push(e)},"begin"),popState:e(function t(){var e=this.conditionStack.length-1;if(e>0){return this.conditionStack.pop()}else{return this.conditionStack[0]}},"popState"),_currentRules:e(function t(){if(this.conditionStack.length&&this.conditionStack[this.conditionStack.length-1]){return this.conditions[this.conditionStack[this.conditionStack.length-1]].rules}else{return this.conditions["INITIAL"].rules}},"_currentRules"),topState:e(function t(e){e=this.conditionStack.length-1-Math.abs(e||0);if(e>=0){return this.conditionStack[e]}else{return"INITIAL"}},"topState"),pushState:e(function t(e){this.begin(e)},"pushState"),stateStackSize:e(function t(){return this.conditionStack.length},"stateStackSize"),options:{"case-insensitive":!0},performAction:e(function t(e,n,a,s){switch(a){case 0:break;case 1:break;case 2:return 10;break;case 3:break;case 4:break;case 5:return 4;break;case 6:return 11;break;case 7:this.begin("acc_title");return 12;break;case 8:this.popState();return"acc_title_value";break;case 9:this.begin("acc_descr");return 14;break;case 10:this.popState();return"acc_descr_value";break;case 11:this.begin("acc_descr_multiline");break;case 12:this.popState();break;case 13:return"acc_descr_multiline_value";break;case 14:return 17;break;case 15:return 18;break;case 16:return 19;break;case 17:return":";break;case 18:return 6;break;case 19:return"INVALID";break}},"anonymous"),rules:[/^(?:%(?!\{)[^\n]*)/i,/^(?:[^\}]%%[^\n]*)/i,/^(?:[\n]+)/i,/^(?:\s+)/i,/^(?:#[^\n]*)/i,/^(?:journey\b)/i,/^(?:title\s[^#\n;]+)/i,/^(?:accTitle\s*:\s*)/i,/^(?:(?!\n||)*[^\n]*)/i,/^(?:accDescr\s*:\s*)/i,/^(?:(?!\n||)*[^\n]*)/i,/^(?:accDescr\s*\{\s*)/i,/^(?:[\}])/i,/^(?:[^\}]*)/i,/^(?:section\s[^#:\n;]+)/i,/^(?:[^#:\n;]+)/i,/^(?::[^#\n;]+)/i,/^(?::)/i,/^(?:$)/i,/^(?:.)/i],conditions:{acc_descr_multiline:{rules:[12,13],inclusive:!1},acc_descr:{rules:[10],inclusive:!1},acc_title:{rules:[8],inclusive:!1},INITIAL:{rules:[0,1,2,3,4,5,6,7,9,11,14,15,16,17,18,19],inclusive:!0}}};return t}();l.lexer=_;function h(){this.yy={}}e(h,"Parser");h.prototype=l;l.Parser=h;return new h}();m.parser=m;var g="";var x=[];var b=[];var v=[];var A=e(function(){x.length=0;b.length=0;g="";v.length=0;n()},"clear");var w=e(function(t){g=t;x.push(t)},"addSection");var $=e(function(){return x},"getSections");var T=e(function(){let t=R();const e=100;let n=0;while(!t&&n<e){t=R();n++}b.push(...v);return b},"getTasks");var B=e(function(){const t=[];b.forEach(e=>{e.people&&t.push(...e.people)});const e=new Set(t);return[...e].sort()},"updateActors");var F=e(function(t,e){const n=e.substr(1).split(":");let a=0;let s=[];if(n.length===1){a=Number(n[0]);s=[]}else{a=Number(n[0]);s=n[1].split(",")}const r=s.map(t=>t.trim());const i={section:g,type:g,people:r,task:t,score:a};v.push(i)},"addTask");var S=e(function(t){const e={section:g,type:g,description:t,task:t,classes:[]};b.push(e)},"addTaskOrg");var R=e(function(){const t=e(function(t){return v[t].processed},"compileTask");let n=!0;for(const[e,a]of v.entries()){t(e);n=n&&a.processed}return n},"compileTasks");var D=e(function(){return B()},"getActors");var J={getConfig:e(()=>a().journey,"getConfig"),clear:A,setDiagramTitle:s,getDiagramTitle:r,setAccTitle:i,getAccTitle:o,setAccDescription:c,getAccDescription:l,addSection:w,getSections:$,getTasks:T,addTask:F,addTaskOrg:S,getActors:D};var H=e(t=>`.label {\n    font-family: ${t.fontFamily};\n    color: ${t.textColor};\n  }\n  .mouth {\n    stroke: #666;\n  }\n\n  line {\n    stroke: ${t.textColor}\n  }\n\n  .legend {\n    fill: ${t.textColor};\n    font-family: ${t.fontFamily};\n  }\n\n  .label text {\n    fill: #333;\n  }\n  .label {\n    color: ${t.textColor}\n  }\n\n  .face {\n    ${t.faceColor?`fill: ${t.faceColor}`:"fill: #FFF8DC"};\n    stroke: #999;\n  }\n\n  .node rect,\n  .node circle,\n  .node ellipse,\n  .node polygon,\n  .node path {\n    fill: ${t.mainBkg};\n    stroke: ${t.nodeBorder};\n    stroke-width: 1px;\n  }\n\n  .node .label {\n    text-align: center;\n  }\n  .node.clickable {\n    cursor: pointer;\n  }\n\n  .arrowheadPath {\n    fill: ${t.arrowheadColor};\n  }\n\n  .edgePath .path {\n    stroke: ${t.lineColor};\n    stroke-width: 1.5px;\n  }\n\n  .flowchart-link {\n    stroke: ${t.lineColor};\n    fill: none;\n  }\n\n  .edgeLabel {\n    background-color: ${t.edgeLabelBackground};\n    rect {\n      opacity: 0.5;\n    }\n    text-align: center;\n  }\n\n  .cluster rect {\n  }\n\n  .cluster text {\n    fill: ${t.titleColor};\n  }\n\n  div.mermaidTooltip {\n    position: absolute;\n    text-align: center;\n    max-width: 200px;\n    padding: 2px;\n    font-family: ${t.fontFamily};\n    font-size: 12px;\n    background: ${t.tertiaryColor};\n    border: 1px solid ${t.border2};\n    border-radius: 2px;\n    pointer-events: none;\n    z-index: 100;\n  }\n\n  .task-type-0, .section-type-0  {\n    ${t.fillType0?`fill: ${t.fillType0}`:""};\n  }\n  .task-type-1, .section-type-1  {\n    ${t.fillType0?`fill: ${t.fillType1}`:""};\n  }\n  .task-type-2, .section-type-2  {\n    ${t.fillType0?`fill: ${t.fillType2}`:""};\n  }\n  .task-type-3, .section-type-3  {\n    ${t.fillType0?`fill: ${t.fillType3}`:""};\n  }\n  .task-type-4, .section-type-4  {\n    ${t.fillType0?`fill: ${t.fillType4}`:""};\n  }\n  .task-type-5, .section-type-5  {\n    ${t.fillType0?`fill: ${t.fillType5}`:""};\n  }\n  .task-type-6, .section-type-6  {\n    ${t.fillType0?`fill: ${t.fillType6}`:""};\n  }\n  .task-type-7, .section-type-7  {\n    ${t.fillType0?`fill: ${t.fillType7}`:""};\n  }\n\n  .actor-0 {\n    ${t.actor0?`fill: ${t.actor0}`:""};\n  }\n  .actor-1 {\n    ${t.actor1?`fill: ${t.actor1}`:""};\n  }\n  .actor-2 {\n    ${t.actor2?`fill: ${t.actor2}`:""};\n  }\n  .actor-3 {\n    ${t.actor3?`fill: ${t.actor3}`:""};\n  }\n  .actor-4 {\n    ${t.actor4?`fill: ${t.actor4}`:""};\n  }\n  .actor-5 {\n    ${t.actor5?`fill: ${t.actor5}`:""};\n  }\n  ${_()}\n`,"getStyles");var G=e(function(t,e){return h(t,e)},"drawRect");var M=e(function(t,n){const a=15;const s=t.append("circle").attr("cx",n.cx).attr("cy",n.cy).attr("class","face").attr("r",a).attr("stroke-width",2).attr("overflow","visible");const r=t.append("g");r.append("circle").attr("cx",n.cx-a/3).attr("cy",n.cy-a/3).attr("r",1.5).attr("stroke-width",2).attr("fill","#666").attr("stroke","#666");r.append("circle").attr("cx",n.cx+a/3).attr("cy",n.cy-a/3).attr("r",1.5).attr("stroke-width",2).attr("fill","#666").attr("stroke","#666");function i(t){const e=u().startAngle(Math.PI/2).endAngle(3*(Math.PI/2)).innerRadius(a/2).outerRadius(a/2.2);t.append("path").attr("class","mouth").attr("d",e).attr("transform","translate("+n.cx+","+(n.cy+2)+")")}e(i,"smile");function o(t){const e=u().startAngle(3*Math.PI/2).endAngle(5*(Math.PI/2)).innerRadius(a/2).outerRadius(a/2.2);t.append("path").attr("class","mouth").attr("d",e).attr("transform","translate("+n.cx+","+(n.cy+7)+")")}e(o,"sad");function c(t){t.append("line").attr("class","mouth").attr("stroke",2).attr("x1",n.cx-5).attr("y1",n.cy+7).attr("x2",n.cx+5).attr("y2",n.cy+7).attr("class","mouth").attr("stroke-width","1px").attr("stroke","#666")}e(c,"ambivalent");if(n.score>3){i(r)}else if(n.score<3){o(r)}else{c(r)}return s},"drawFace");var E=e(function(t,e){const n=t.append("circle");n.attr("cx",e.cx);n.attr("cy",e.cy);n.attr("class","actor-"+e.pos);n.attr("fill",e.fill);n.attr("stroke",e.stroke);n.attr("r",e.r);n.class!==void 0&&n.attr("class",n.class);e.title!==void 0&&n.append("title").text(e.title);return n},"drawCircle");var C=e(function(t,e){return d(t,e)},"drawText");var P=e(function(t,n){function a(t,e,n,a,s){return t+","+e+" "+(t+n)+","+e+" "+(t+n)+","+(e+a-s)+" "+(t+n-s*1.2)+","+(e+a)+" "+t+","+(e+a)}e(a,"genPoints");const s=t.append("polygon");s.attr("points",a(n.x,n.y,50,20,7));s.attr("class","labelBox");n.y=n.y+n.labelMargin;n.x=n.x+.5*n.labelMargin;C(t,n)},"drawLabel");var L=e(function(t,e,n){const a=t.append("g");const s=y();s.x=e.x;s.y=e.y;s.fill=e.fill;s.width=n.width*e.taskCount+n.diagramMarginX*(e.taskCount-1);s.height=n.height;s.class="journey-section section-type-"+e.num;s.rx=3;s.ry=3;G(a,s);O(n)(e.text,a,s.x,s.y,s.width,s.height,{class:"journey-section section-type-"+e.num},n,e.colour)},"drawSection");var j=-1;var V=e(function(t,e,n){const a=e.x+n.width/2;const s=t.append("g");j++;const r=300+5*30;s.append("line").attr("id","task"+j).attr("x1",a).attr("y1",e.y).attr("x2",a).attr("y2",r).attr("class","task-line").attr("stroke-width","1px").attr("stroke-dasharray","4 2").attr("stroke","#666");M(s,{cx:a,cy:300+(5-e.score)*30,score:e.score});const i=y();i.x=e.x;i.y=e.y;i.fill=e.fill;i.width=n.width;i.height=n.height;i.class="task task-type-"+e.num;i.rx=3;i.ry=3;G(s,i);let o=e.x+14;e.people.forEach(t=>{const n=e.actors[t].color;const a={cx:o,cy:e.y,r:7,fill:n,stroke:"#000",title:t,pos:e.actors[t].position};E(s,a);o+=10});O(n)(e.task,s,i.x,i.y,i.width,i.height,{class:"task"},n,e.colour)},"drawTask");var I=e(function(t,e){p(t,e)},"drawBackgroundRect");var O=function(){function t(t,e,n,a,r,i,o,c){const l=e.append("text").attr("x",n+r/2).attr("y",a+i/2+5).style("font-color",c).style("text-anchor","middle").text(t);s(l,o)}e(t,"byText");function n(t,e,n,a,r,i,o,c,l){const{taskFontSize:_,taskFontFamily:h}=c;const u=t.split(/<br\s*\/?>/gi);for(let t=0;t<u.length;t++){let c=t*_-_*(u.length-1)/2,d=e.append("text").attr("x",n+r/2).attr("y",a).attr("fill",l).style("text-anchor","middle").style("font-size",_).style("font-family",h);d.append("tspan").attr("x",n+r/2).attr("dy",c).text(u[t]);d.attr("y",a+i/2).attr("dominant-baseline","central").attr("alignment-baseline","central");s(d,o)}}e(n,"byTspan");function a(t,e,a,r,i,o,c,l){const _=e.append("switch");const h=_.append("foreignObject").attr("x",a).attr("y",r).attr("width",i).attr("height",o).attr("position","fixed");const u=h.append("xhtml:div").style("display","table").style("height","100%").style("width","100%");u.append("div").attr("class","label").style("display","table-cell").style("text-align","center").style("vertical-align","middle").text(t);n(t,_,a,r,i,o,c,l);s(u,c)}e(a,"byFo");function s(t,e){for(const n in e){n in e&&t.attr(n,e[n])}}e(s,"_setTextAttrs");return function(e){return e.textPlacement==="fo"?a:e.textPlacement==="old"?t:n}}();var Z=e(function(t){t.append("defs").append("marker").attr("id","arrowhead").attr("refX",5).attr("refY",2).attr("markerWidth",6).attr("markerHeight",4).attr("orient","auto").append("path").attr("d","M 0,0 V 4 L6,2 Z")},"initGraphics");var Y={drawRect:G,drawCircle:E,drawSection:L,drawText:C,drawLabel:P,drawTask:V,drawBackgroundRect:I,initGraphics:Z};var W=e(function(t){const e=Object.keys(t);e.forEach(function(e){q[e]=t[e]})},"setConf");var N={};var K=0;function z(t){const e=a().journey;const n=e.maxLabelWidth;K=0;let s=60;Object.keys(N).forEach(a=>{const r=N[a].color;const i={cx:20,cy:s,r:7,fill:r,stroke:"#000",pos:N[a].position};Y.drawCircle(t,i);let o=t.append("text").attr("visibility","hidden").text(a);const c=o.node().getBoundingClientRect().width;o.remove();let l=[];if(c<=n){l=[a]}else{let e=a.split(" "),s="";o=t.append("text").attr("visibility","hidden");e.forEach(t=>{const e=s?`${s} ${t}`:t;o.text(e);const a=o.node().getBoundingClientRect().width;if(a>n){s&&l.push(s);s=t;o.text(t);if(o.node().getBoundingClientRect().width>n){let e="";for(const a of t){e+=a;o.text(e+"-");if(o.node().getBoundingClientRect().width>n){l.push(e.slice(0,-1)+"-");e=a}}s=e}}else{s=e}});s&&l.push(s);o.remove()}l.forEach((n,a)=>{var r;const i={x:40,y:s+7+a*20,fill:"#666",text:n,textMargin:(r=e.boxTextMargin)!==null&&r!==void 0?r:5};const o=Y.drawText(t,i);const c=o.node().getBoundingClientRect().width;c>K&&c>e.leftMargin-c&&(K=c)});s+=Math.max(20,l.length*20)})}e(z,"drawActorLegend");var q=a().journey;var X=0;var U=e(function(t,e,n,s){const r=a();const i=r.journey.titleColor;const o=r.journey.titleFontSize;const c=r.journey.titleFontFamily;const l=r.securityLevel;let _;l==="sandbox"&&(_=k("#i"+e));const h=l==="sandbox"?k(_.nodes()[0].contentDocument.body):k("body");Q.init();const u=h.select("#"+e);Y.initGraphics(u);const d=s.db.getTasks();const y=s.db.getDiagramTitle();const p=s.db.getActors();for(const t in N){delete N[t]}let m=0;p.forEach(t=>{N[t]={color:q.actorColours[m%q.actorColours.length],position:m};m++});z(u);X=q.leftMargin+K;Q.insert(0,0,X,Object.keys(N).length*50);nt(u,d,0);const g=Q.getBounds();y&&u.append("text").text(y).attr("x",X).attr("font-size",o).attr("font-weight","bold").attr("y",25).attr("fill",i).attr("font-family",c);const x=g.stopy-g.starty+2*q.diagramMarginY;const b=X+g.stopx+2*q.diagramMarginX;f(u,x,b,q.useMaxWidth);u.append("line").attr("x1",X).attr("y1",q.height*4).attr("x2",b-X-4).attr("y2",q.height*4).attr("stroke-width",4).attr("stroke","black").attr("marker-end","url(#arrowhead)");const v=y?70:0;u.attr("viewBox",`${g.startx} -25 ${b} ${x+v}`);u.attr("preserveAspectRatio","xMinYMin meet");u.attr("height",x+v+25)},"draw");var Q={data:{startx:void 0,stopx:void 0,starty:void 0,stopy:void 0},verticalPos:0,sequenceItems:[],init:e(function(){this.sequenceItems=[];this.data={startx:void 0,stopx:void 0,starty:void 0,stopy:void 0};this.verticalPos=0},"init"),updateVal:e(function(t,e,n,a){if(t[e]===void 0){t[e]=n}else{t[e]=a(n,t[e])}},"updateVal"),updateBounds:e(function(t,n,s,r){const i=a().journey;const o=this;let c=0;function l(a){return e(function e(l){c++;const _=o.sequenceItems.length-c+1;o.updateVal(l,"starty",n-_*i.boxMargin,Math.min);o.updateVal(l,"stopy",r+_*i.boxMargin,Math.max);o.updateVal(Q.data,"startx",t-_*i.boxMargin,Math.min);o.updateVal(Q.data,"stopx",s+_*i.boxMargin,Math.max);if(!(a==="activation")){o.updateVal(l,"startx",t-_*i.boxMargin,Math.min);o.updateVal(l,"stopx",s+_*i.boxMargin,Math.max);o.updateVal(Q.data,"starty",n-_*i.boxMargin,Math.min);o.updateVal(Q.data,"stopy",r+_*i.boxMargin,Math.max)}},"updateItemBounds")}e(l,"updateFn");this.sequenceItems.forEach(l())},"updateBounds"),insert:e(function(t,e,n,a){const s=Math.min(t,n);const r=Math.max(t,n);const i=Math.min(e,a);const o=Math.max(e,a);this.updateVal(Q.data,"startx",s,Math.min);this.updateVal(Q.data,"starty",i,Math.min);this.updateVal(Q.data,"stopx",r,Math.max);this.updateVal(Q.data,"stopy",o,Math.max);this.updateBounds(s,i,r,o)},"insert"),bumpVerticalPos:e(function(t){this.verticalPos=this.verticalPos+t;this.data.stopy=this.verticalPos},"bumpVerticalPos"),getVerticalPos:e(function(){return this.verticalPos},"getVerticalPos"),getBounds:e(function(){return this.data},"getBounds")};var tt=q.sectionFills;var et=q.sectionColours;var nt=e(function(t,e,n){const s=a().journey;let r="";const i=s.height*2+s.diagramMarginY;const o=n+i;let c=0;let l="#CCC";let _="black";let h=0;for(const[n,a]of e.entries()){if(r!==a.section){l=tt[c%tt.length];h=c%tt.length;_=et[c%et.length];let i=0,o=a.section;for(let t=n;t<e.length;t++){if(e[t].section==o){i=i+1}else{break}}let u={x:n*s.taskMargin+n*s.width+X,y:50,text:a.section,fill:l,num:h,colour:_,taskCount:i};Y.drawSection(t,u,s);r=a.section;c++}let i=a.people.reduce((t,e)=>{N[e]&&(t[e]=N[e]);return t},{});a.x=n*s.taskMargin+n*s.width+X;a.y=o;a.width=s.diagramMarginX;a.height=s.diagramMarginY;a.colour=_;a.fill=l;a.num=h;a.actors=i;Y.drawTask(t,a,s);Q.insert(a.x,a.y,a.x+a.width+s.taskMargin,300+5*30)}},"drawTasks");var at={setConf:W,draw:U};var st={parser:m,db:J,renderer:at,styles:H,init:e(t=>{at.setConf(t.journey);J.clear()},"init")};var rt={diagram:st};__bbb.N=rt}).call(this)